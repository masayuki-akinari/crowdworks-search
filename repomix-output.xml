This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.dockerignore
.eslintrc.js
.github/workflows/ci.yml
.prettierrc
app.ts
cdk.json
docker-compose.yml
Dockerfile
docs/01_requirements.md
docs/02_system_design.md
docs/03_data_design.md
docs/04_api_design.md
docs/05_implementation_plan.md
docs/README.md
jest.config.js
package.json
readme.md
src/index.ts
src/infrastructure/crowdworks-searcher-stack.ts
src/lambda/handler.ts
src/types/index.ts
test/sample.test.ts
test/setup.ts
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app.ts">
#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { CrowdWorksSearcherStack } from './src/infrastructure/crowdworks-searcher-stack';

const app = new cdk.App();

// ç’°å¢ƒè¨­å®š
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION || process.env.AWS_REGION || 'ap-northeast-1',
};

// ã‚¹ã‚¿ãƒƒã‚¯ä½œæˆ
new CrowdWorksSearcherStack(app, 'CrowdWorksSearcherStack', {
    env,
    description: 'CrowdWorks Auto Job Searcher System',
});
</file>

<file path="cdk.json">
{
    "app": "npx ts-node --prefer-ts-exts app.ts",
    "watch": {
        "include": [
            "**"
        ],
        "exclude": [
            "README.md",
            "cdk*.json",
            "**/*.d.ts",
            "**/*.js",
            "tsconfig.json",
            "package*.json",
            "yarn.lock",
            "node_modules",
            "test"
        ]
    },
    "context": {
        "@aws-cdk/aws-lambda:recognizeLayerVersion": true,
        "@aws-cdk/core:checkSecretUsage": true,
        "@aws-cdk/core:target-partitions": [
            "aws",
            "aws-cn"
        ],
        "@aws-cdk-containers/ecs-service-extensions:enableDefaultLogDriver": true,
        "@aws-cdk/aws-ec2:uniqueImdsv2TemplateName": true,
        "@aws-cdk/aws-ecs:arnFormatIncludesClusterName": true,
        "@aws-cdk/aws-iam:minimizePolicies": true,
        "@aws-cdk/core:validateSnapshotRemovalPolicy": true,
        "@aws-cdk/aws-codepipeline:crossAccountKeyAliasStackSafeResourceName": true,
        "@aws-cdk/aws-s3:createDefaultLoggingPolicy": true,
        "@aws-cdk/aws-sns-subscriptions:restrictSqsDescryption": true,
        "@aws-cdk/aws-apigateway:disableCloudWatchRole": true,
        "@aws-cdk/core:enablePartitionLiterals": true,
        "@aws-cdk/aws-events:eventsTargetQueueSameAccount": true,
        "@aws-cdk/aws-iam:standardizedServicePrincipals": true,
        "@aws-cdk/aws-ecs:disableExplicitDeploymentControllerForCircuitBreaker": true,
        "@aws-cdk/aws-iam:importedRoleStackSafeDefaultPolicyName": true,
        "@aws-cdk/aws-s3:serverAccessLogsUseBucketPolicy": true,
        "@aws-cdk/aws-route53-patters:useCertificate": true,
        "@aws-cdk/customresources:installLatestAwsSdkDefault": false,
        "@aws-cdk/aws-rds:databaseProxyUniqueResourceName": true,
        "@aws-cdk/aws-codedeploy:removeAlarmsFromDeploymentGroup": true,
        "@aws-cdk/aws-apigateway:authorizerChangeDeploymentLogicalId": true,
        "@aws-cdk/aws-ec2:launchTemplateDefaultUserData": true,
        "@aws-cdk/aws-secretsmanager:useAttachedSecretResourcePolicyForSecretTargetAttachments": true,
        "@aws-cdk/aws-redshift:columnId": true,
        "@aws-cdk/aws-stepfunctions-tasks:enableLoggingForLambdaTask": true,
        "@aws-cdk/aws-ec2:restrictDefaultSecurityGroup": true,
        "@aws-cdk/aws-apigateway:requestValidatorUniqueId": true,
        "@aws-cdk/aws-kms:aliasNameRef": true,
        "@aws-cdk/aws-autoscaling:generateLaunchTemplateInsteadOfLaunchConfig": true,
        "@aws-cdk/core:includePrefixInUniqueNameGeneration": true,
        "@aws-cdk/aws-efs:denyAnonymousAccess": true,
        "@aws-cdk/aws-opensearchservice:enableOpensearchMultiAzWithStandby": true,
        "@aws-cdk/aws-lambda-nodejs:useLatestRuntimeVersion": true,
        "@aws-cdk/aws-efs:mountTargetOrderInsensitiveLogicalId": true,
        "@aws-cdk/aws-rds:auroraClusterChangeScopeOfInstanceParameterGroupWithEachParameters": true,
        "@aws-cdk/aws-appsync:useArnForSourceApiAssociationIdentifier": true,
        "@aws-cdk/aws-rds:preventRenderingDeprecatedCredentials": true,
        "@aws-cdk/aws-codepipeline-actions:useNewDefaultBranchForSourceAction": true
    }
}
</file>

<file path="src/infrastructure/crowdworks-searcher-stack.ts">
import * as cdk from 'aws-cdk-lib';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as s3 from 'aws-cdk-lib/aws-s3';
import * as events from 'aws-cdk-lib/aws-events';
import * as targets from 'aws-cdk-lib/aws-events-targets';
import * as iam from 'aws-cdk-lib/aws-iam';
import { Construct } from 'constructs';

export class CrowdWorksSearcherStack extends cdk.Stack {
    constructor(scope: Construct, id: string, props?: cdk.StackProps) {
        super(scope, id, props);

        // S3ãƒã‚±ãƒƒãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ï¼‰
        const dataBucket = new s3.Bucket(this, 'CrowdWorksDataBucket', {
            bucketName: `crowdworks-searcher-data-${this.account}`,
            encryption: s3.BucketEncryption.S3_MANAGED,
            blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
            lifecycleRules: [
                {
                    id: 'DeleteOldData',
                    enabled: true,
                    expiration: cdk.Duration.days(7),
                }
            ],
            removalPolicy: cdk.RemovalPolicy.DESTROY,
            autoDeleteObjects: true,
        });

        // Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«
        const lambdaRole = new iam.Role(this, 'LambdaExecutionRole', {
            assumedBy: new iam.ServicePrincipal('lambda.amazonaws.com'),
            managedPolicies: [
                iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSLambdaBasicExecutionRole')
            ],
            inlinePolicies: {
                S3Access: new iam.PolicyDocument({
                    statements: [
                        new iam.PolicyStatement({
                            effect: iam.Effect.ALLOW,
                            actions: [
                                's3:GetObject',
                                's3:PutObject',
                                's3:ListBucket'
                            ],
                            resources: [
                                dataBucket.bucketArn,
                                `${dataBucket.bucketArn}/*`
                            ]
                        })
                    ]
                })
            }
        });

        // Lambdaé–¢æ•°ï¼ˆåŸºæœ¬ç‰ˆï¼‰
        const mainFunction = new lambda.Function(this, 'CrowdWorksMainFunction', {
            runtime: lambda.Runtime.NODEJS_18_X,
            handler: 'lambda/handler.lambdaHandler',
            code: lambda.Code.fromAsset('./dist'),
            timeout: cdk.Duration.minutes(10),
            memorySize: 1024,
            role: lambdaRole,
            environment: {
                DATA_BUCKET_NAME: dataBucket.bucketName,
                AWS_REGION: this.region,
            },
        });

        // EventBridgeï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ï¼‰
        const scheduleRule = new events.Rule(this, 'ScheduleRule', {
            schedule: events.Schedule.rate(cdk.Duration.minutes(15)),
            description: 'CrowdWorksæ¡ˆä»¶æ¤œç´¢ã®å®šæœŸå®Ÿè¡Œï¼ˆ15åˆ†é–“éš”ï¼‰',
        });

        scheduleRule.addTarget(new targets.LambdaFunction(mainFunction));

        // å‡ºåŠ›
        new cdk.CfnOutput(this, 'DataBucketName', {
            value: dataBucket.bucketName,
            description: 'S3ãƒ‡ãƒ¼ã‚¿ãƒã‚±ãƒƒãƒˆå',
        });

        new cdk.CfnOutput(this, 'LambdaFunctionName', {
            value: mainFunction.functionName,
            description: 'Lambdaé–¢æ•°å',
        });
    }
}
</file>

<file path=".dockerignore">
# Dependencies
node_modules
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Build outputs
dist
build
*.tsbuildinfo

# Coverage directory used by tools like istanbul
coverage

# CDK outputs
cdk.out

# Environment variables
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# IDE files
.vscode
.idea
*.swp
*.swo
*~

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Git
.git
.gitignore

# Docker
Dockerfile*
docker-compose*
.dockerignore

# Documentation
docs
*.md
repomix-output.xml

# Test files
test
*.test.ts
*.spec.ts
__tests__

# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Temporary folders
tmp
temp
</file>

<file path=".eslintrc.js">
module.exports = {
    parser: '@typescript-eslint/parser',
    parserOptions: {
        ecmaVersion: 2022,
        sourceType: 'module',
        project: './tsconfig.json',
    },
    plugins: [
        '@typescript-eslint',
        'import',
        'jest'
    ],
    extends: [
        'eslint:recommended',
        '@typescript-eslint/recommended',
        '@typescript-eslint/recommended-requiring-type-checking',
        'prettier'
    ],
    env: {
        node: true,
        es2022: true,
        jest: true
    },
    rules: {
        // anyå‹ã‚’å³æ ¼ã«ç¦æ­¢
        '@typescript-eslint/no-explicit-any': 'error',
        '@typescript-eslint/no-unsafe-any': 'error',
        '@typescript-eslint/no-unsafe-assignment': 'error',
        '@typescript-eslint/no-unsafe-call': 'error',
        '@typescript-eslint/no-unsafe-member-access': 'error',
        '@typescript-eslint/no-unsafe-return': 'error',
        '@typescript-eslint/no-unsafe-argument': 'error',

        // TypeScript strict mode é–¢é€£
        '@typescript-eslint/no-unused-vars': ['error', {
            argsIgnorePattern: '^_',
            varsIgnorePattern: '^_'
        }],
        '@typescript-eslint/explicit-function-return-type': 'warn',
        '@typescript-eslint/explicit-module-boundary-types': 'warn',
        '@typescript-eslint/no-non-null-assertion': 'error',
        '@typescript-eslint/prefer-nullish-coalescing': 'error',
        '@typescript-eslint/prefer-optional-chain': 'error',
        '@typescript-eslint/strict-boolean-expressions': 'error',

        // ã‚³ãƒ¼ãƒ‰å“è³ª
        '@typescript-eslint/no-floating-promises': 'error',
        '@typescript-eslint/await-thenable': 'error',
        '@typescript-eslint/require-await': 'error',
        '@typescript-eslint/return-await': 'error',

        // importé–¢é€£
        'import/order': ['error', {
            'groups': [
                'builtin',
                'external',
                'internal',
                'parent',
                'sibling',
                'index'
            ],
            'newlines-between': 'always',
            'alphabetize': {
                'order': 'asc',
                'caseInsensitive': true
            }
        }],
        'import/no-unresolved': 'off', // TypeScript handles this

        // General rules
        'no-console': 'warn',
        'no-debugger': 'error',
        'prefer-const': 'error',
        'no-var': 'error',

        // Jest specific rules
        'jest/no-disabled-tests': 'warn',
        'jest/no-focused-tests': 'error',
        'jest/no-identical-title': 'error',
        'jest/prefer-to-have-length': 'warn',
        'jest/valid-expect': 'error'
    },
    overrides: [
        {
            files: ['**/*.test.ts', '**/*.spec.ts'],
            env: {
                jest: true
            },
            rules: {
                '@typescript-eslint/no-non-null-assertion': 'off',
                '@typescript-eslint/explicit-function-return-type': 'off'
            }
        },
        {
            files: ['src/infrastructure/**/*.ts'],
            rules: {
                // CDK constructs may need looser rules
                '@typescript-eslint/explicit-function-return-type': 'off'
            }
        }
    ],
    ignorePatterns: [
        'dist/',
        'node_modules/',
        'cdk.out/',
        '*.js',
        '*.d.ts'
    ]
};
</file>

<file path=".github/workflows/ci.yml">
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ main, develop ]

env:
  NODE_VERSION: '18'
  AWS_REGION: 'ap-northeast-1'

jobs:
  # ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆæœ€é€Ÿå®Ÿè¡Œï¼‰
  code-quality:
    name: Code Quality Check
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Lint check
        run: npm run lint

      - name: Format check
        run: npm run format -- --check

      - name: TypeScript type check
        run: npm run type-check

  # å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆDockerç’°å¢ƒï¼‰
  unit-tests:
    name: Unit Tests
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: code-quality
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build Docker image for testing
        run: |
          docker build -t crowdworks-search:test .

      - name: Run unit tests in Docker
        run: |
          docker run --rm \
            -v ${{ github.workspace }}:/workspace \
            -e NODE_ENV=test \
            -e AWS_REGION=${{ env.AWS_REGION }} \
            crowdworks-search:test \
            npm run test:coverage

      - name: Upload coverage reports
        uses: codecov/codecov-action@v3
        if: always()
        with:
          file: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella

  # ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
  build-test:
    name: Build Test
    runs-on: ubuntu-latest
    timeout-minutes: 10
    needs: code-quality
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build TypeScript
        run: npm run build

      - name: Verify build output
        run: |
          if [ ! -d "dist" ]; then
            echo "Build failed: dist directory not found"
            exit 1
          fi
          if [ ! -f "dist/index.js" ]; then
            echo "Build failed: main output file not found"
            exit 1
          fi
          echo "âœ… Build verification passed"

  # CDKæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
  cdk-synth:
    name: CDK Synth Check
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: code-quality
    if: github.event_name == 'push' || github.event_name == 'pull_request'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build TypeScript
        run: npm run build

      - name: CDK Synth (dry-run)
        run: npm run cdk:synth
        env:
          CDK_DEFAULT_REGION: ${{ env.AWS_REGION }}

  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest
    timeout-minutes: 10
    needs: code-quality
    if: github.event_name == 'push'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run npm audit
        run: npm audit --audit-level=high
        continue-on-error: true

      - name: Run CodeQL Analysis
        uses: github/codeql-action/init@v2
        with:
          languages: javascript

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2

  # çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆDockerç’°å¢ƒï¼‰
  integration-tests:
    name: Integration Tests
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: [unit-tests, build-test]
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build test environment
        run: |
          docker-compose build test

      - name: Run integration tests
        run: |
          docker-compose --profile test run --rm test npm run test:integration

  # Stagingç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs: [unit-tests, build-test, cdk-synth]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.STAGING_AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.STAGING_AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Deploy to staging
        run: |
          npm run cdk:deploy -- --require-approval never --context stage=staging
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          CROWDWORKS_EMAIL: ${{ secrets.CROWDWORKS_EMAIL }}
          CROWDWORKS_PASSWORD: ${{ secrets.CROWDWORKS_PASSWORD }}

      - name: Run smoke tests
        run: |
          # åŸºæœ¬çš„ãªãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
          echo "ğŸ§ª Running staging smoke tests..."
          # TODO: å®Ÿéš›ã®ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…

  # Productionç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ‰‹å‹•æ‰¿èªï¼‰
  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs: [deploy-staging, integration-tests]
    if: startsWith(github.ref, 'refs/tags/v')
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.PRODUCTION_AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.PRODUCTION_AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Deploy to production
        run: |
          npm run cdk:deploy -- --require-approval never --context stage=production
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          CROWDWORKS_EMAIL: ${{ secrets.CROWDWORKS_EMAIL }}
          CROWDWORKS_PASSWORD: ${{ secrets.CROWDWORKS_PASSWORD }}

      - name: Post-deployment verification
        run: |
          echo "ğŸš€ Production deployment completed"
          echo "Tag: ${{ github.ref }}"
          echo "Commit: ${{ github.sha }}"

  # é€šçŸ¥ï¼ˆå¤±æ•—æ™‚ã®ã¿ï¼‰
  notify-failure:
    name: Notify Failure
    runs-on: ubuntu-latest
    needs: [code-quality, unit-tests, build-test, cdk-synth]
    if: failure()
    
    steps:
      - name: Notify failure
        run: |
          echo "âŒ CI/CD Pipeline failed"
          echo "Branch: ${{ github.ref }}"
          echo "Commit: ${{ github.sha }}"
          echo "Actor: ${{ github.actor }}"
          # TODO: Slacké€šçŸ¥ãªã©ã‚’å®Ÿè£…
</file>

<file path=".prettierrc">
{
    "semi": true,
    "trailingComma": "es5",
    "singleQuote": true,
    "printWidth": 100,
    "tabWidth": 2,
    "useTabs": false,
    "bracketSpacing": true,
    "arrowParens": "avoid",
    "endOfLine": "lf",
    "quoteProps": "as-needed",
    "bracketSameLine": false,
    "embeddedLanguageFormatting": "auto"
}
</file>

<file path="docker-compose.yml">
version: '3.8'

services:
  # ãƒ¡ã‚¤ãƒ³é–‹ç™ºç’°å¢ƒ
  crowdworks-search:
    build:
      context: .
      dockerfile: Dockerfile
      target: development  # é–‹ç™ºç”¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ä½¿ç”¨
    container_name: crowdworks-search-dev
    volumes:
      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¦ãƒ³ãƒˆï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é–‹ç™ºç”¨ï¼‰
      - .:/workspace
      - /workspace/node_modules  # node_modulesã¯é™¤å¤–
      - /workspace/dist          # distã¯é™¤å¤–
      # AWSèªè¨¼æƒ…å ±ã®ãƒã‚¦ãƒ³ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
      - ~/.aws:/root/.aws:ro
    environment:
      # é–‹ç™ºç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°
      - NODE_ENV=development
      - AWS_REGION=ap-northeast-1
      - LOG_LEVEL=debug
      # Playwrightè¨­å®š
      - PLAYWRIGHT_BROWSERS_PATH=/ms-playwright
    ports:
      - "3000:3000"  # å°†æ¥çš„ãªAPI Gateway Localç”¨
      - "9229:9229"  # Node.js ãƒ‡ãƒãƒƒã‚°ãƒãƒ¼ãƒˆ
    working_dir: /workspace
    # é–‹ç™ºç”¨ã®ã‚³ãƒãƒ³ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
    command: tail -f /dev/null  # ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•çŠ¶æ…‹ã§ç¶­æŒ
    stdin_open: true
    tty: true

  # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå°‚ç”¨ã‚³ãƒ³ãƒ†ãƒŠ
  test:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    container_name: crowdworks-search-test
    volumes:
      - .:/workspace
      - /workspace/node_modules
      - /workspace/dist
    environment:
      - NODE_ENV=test
      - AWS_REGION=ap-northeast-1
    working_dir: /workspace
    command: npm run test:coverage
    profiles:
      - test  # docker-compose --profile test up ã§å®Ÿè¡Œ

  # AWS CDKå°‚ç”¨ã‚³ãƒ³ãƒ†ãƒŠ
  cdk:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    container_name: crowdworks-search-cdk
    volumes:
      - .:/workspace
      - /workspace/node_modules
      - /workspace/cdk.out
      - ~/.aws:/root/.aws:ro
    environment:
      - AWS_REGION=ap-northeast-1
      - CDK_DEFAULT_REGION=ap-northeast-1
    working_dir: /workspace
    command: tail -f /dev/null
    profiles:
      - cdk  # docker-compose --profile cdk up ã§å®Ÿè¡Œ

  # æœ¬ç•ªç’°å¢ƒãƒ†ã‚¹ãƒˆç”¨ï¼ˆLambdaç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  lambda-test:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    container_name: crowdworks-search-lambda
    environment:
      - AWS_LAMBDA_RUNTIME_API=localhost:9000
      - _HANDLER=dist/lambda/handler.lambdaHandler
    ports:
      - "9000:8080"  # Lambda Runtime Interface Emulator
    profiles:
      - lambda  # docker-compose --profile lambda up ã§å®Ÿè¡Œ

networks:
  default:
    name: crowdworks-search-network
</file>

<file path="Dockerfile">
# Lambdaç’°å¢ƒã«è¿‘ã„Amazon Linux 2ãƒ™ãƒ¼ã‚¹ï¼ˆNode.js 18ï¼‰
FROM public.ecr.aws/lambda/nodejs:18 as base

# é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
USER root

# å¿…è¦ãªã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN dnf update -y && \
    dnf install -y \
    git \
    tar \
    gzip \
    unzip \
    which \
    procps \
    && dnf clean all

# AWS CLI v2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" && \
    unzip awscliv2.zip && \
    ./aws/install && \
    rm -rf awscliv2.zip aws

# AWS CDK CLIã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN npm install -g aws-cdk@latest

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š
WORKDIR /workspace

# package.jsonã¨package-lock.jsonã‚’ã‚³ãƒ”ãƒ¼ï¼ˆä¾å­˜é–¢ä¿‚ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡åŒ–ï¼‰
COPY package*.json ./

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN npm ci

# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆLambda Layerç”¨ï¼‰
RUN npx playwright install --with-deps chromium

# === é–‹ç™ºç”¨ã‚¹ãƒ†ãƒ¼ã‚¸ ===
FROM base as development

# é–‹ç™ºç”¨ã®è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
RUN npm install -g nodemon ts-node

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY . .

# TypeScriptã®ãƒ“ãƒ«ãƒ‰
RUN npm run build

# é–‹ç™ºç”¨ãƒãƒ¼ãƒˆã‚’å…¬é–‹ï¼ˆå°†æ¥çš„ãªAPI Gateway Localç”¨ï¼‰
EXPOSE 3000

# é–‹ç™ºç”¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰
CMD ["npm", "run", "dev"]

# === æœ¬ç•ªç”¨ã‚¹ãƒ†ãƒ¼ã‚¸ ===
FROM base as production

# æœ¬ç•ªç”¨ã®æœ€å°é™ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

# ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
COPY --from=development /workspace/dist ./dist

# Lambdaé–¢æ•°ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®è¨­å®š
CMD ["dist/lambda/handler.lambdaHandler"]
</file>

<file path="docs/README.md">
# è¨­è¨ˆæ›¸ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹æ¡ˆä»¶è‡ªå‹•æ¤œç´¢ãƒ»è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆæ›¸ã§ã™ã€‚

## ğŸ“š è¨­è¨ˆæ›¸ä¸€è¦§

### 1. [è¦ä»¶å®šç¾©æ›¸](./01_requirements.md)
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„ã€æ©Ÿèƒ½è¦ä»¶ã€éæ©Ÿèƒ½è¦ä»¶ã‚’å®šç¾©

### 2. [ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸](./02_system_design.md)  
ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 3. [ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ›¸](./03_data_design.md)
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨ãƒ‡ãƒ¼ã‚¿å‹å®šç¾©

### 4. [APIè¨­è¨ˆæ›¸](./04_api_design.md)
å†…éƒ¨APIãƒ»å¤–éƒ¨APIé€£æºã®ä»•æ§˜å®šç¾©

### 5. [å®Ÿè£…è¨ˆç”»æ›¸](./05_implementation_plan.md)
é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºã¨ã‚¿ã‚¹ã‚¯åˆ†è§£ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

## ğŸ”„ è¨­è¨ˆæ›¸ä½œæˆã®é€²ã‚æ–¹

1. **è¦ä»¶å®šç¾©æ›¸** ã‹ã‚‰é–‹å§‹
2. **ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸** ã§å…¨ä½“åƒã‚’æ•´ç†
3. **ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ›¸** ã§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ±ºå®š
4. **APIè¨­è¨ˆæ›¸** ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©
5. **å®Ÿè£…è¨ˆç”»æ›¸** ã§é–‹ç™ºã‚’è¨ˆç”»

## ğŸ“ æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | æ›´æ–°è€… | æ›´æ–°å†…å®¹ |
|------|--------|----------|
|      |        |          |
</file>

<file path="jest.config.js">
module.exports = {
    // ãƒ†ã‚¹ãƒˆç’°å¢ƒ
    preset: 'ts-jest',
    testEnvironment: 'node',

    // TypeScriptè¨­å®š
    transform: {
        '^.+\\.tsx?$': ['ts-jest', {
            tsconfig: './tsconfig.json',
            isolatedModules: true
        }]
    },

    // ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã®è¨­å®š
    moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json'],

    // ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆtsconfig.jsonã¨åŒæœŸï¼‰
    moduleNameMapping: {
        '^@/(.*)$': '<rootDir>/src/$1',
        '^@/types/(.*)$': '<rootDir>/src/types/$1',
        '^@/services/(.*)$': '<rootDir>/src/services/$1',
        '^@/utils/(.*)$': '<rootDir>/src/utils/$1',
        '^@/infrastructure/(.*)$': '<rootDir>/src/infrastructure/$1'
    },

    // ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
    testMatch: [
        '<rootDir>/src/**/*.test.(ts|tsx)',
        '<rootDir>/src/**/*.spec.(ts|tsx)',
        '<rootDir>/test/**/*.test.(ts|tsx)',
        '<rootDir>/test/**/*.spec.(ts|tsx)'
    ],

    // ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®š
    collectCoverage: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åŠ¹ï¼ˆnpm run test:coverageã§æœ‰åŠ¹ï¼‰
    collectCoverageFrom: [
        'src/**/*.{ts,tsx}',
        '!src/**/*.d.ts',
        '!src/**/*.test.{ts,tsx}',
        '!src/**/*.spec.{ts,tsx}',
        '!src/test/**/*',
        '!src/types/**/*', // å‹å®šç¾©ã¯ã‚«ãƒãƒ¬ãƒƒã‚¸ã‹ã‚‰é™¤å¤–
    ],
    coverageDirectory: 'coverage',
    coverageReporters: ['text', 'lcov', 'html'],
    coverageThreshold: {
        global: {
            branches: 75,
            functions: 80,
            lines: 80,
            statements: 80
        }
    },

    // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«
    setupFilesAfterEnv: ['<rootDir>/test/setup.ts'],

    // ãƒ¢ãƒƒã‚¯è¨­å®š
    clearMocks: true,
    resetMocks: true,
    restoreMocks: true,

    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
    testTimeout: 30000, // 30ç§’ï¼ˆAWS SDKå‘¼ã³å‡ºã—ãªã©æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆã«å¯¾å¿œï¼‰

    // ä¸¦åˆ—å®Ÿè¡Œè¨­å®š
    maxWorkers: '50%', // CPUã‚³ã‚¢æ•°ã®50%ã§ä¸¦åˆ—å®Ÿè¡Œ

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºè¨­å®š
    verbose: true,
    errorOnDeprecated: true,

    // ä¸è¦ãªãƒ­ã‚°ã‚’æŠ‘åˆ¶
    silent: false,

    // Jestç’°å¢ƒã§ã®è­¦å‘Šã‚’æŠ‘åˆ¶
    globals: {
        'ts-jest': {
            useESM: false,
            tsconfig: './tsconfig.json'
        }
    },

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰å¾Œã®ãƒ•ãƒƒã‚¯
    globalSetup: undefined,
    globalTeardown: undefined
};
</file>

<file path="package.json">
{
    "name": "crowdworks-search",
    "version": "1.0.0",
    "description": "ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹æ¡ˆä»¶è‡ªå‹•æ¤œç´¢ãƒ»è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ",
    "main": "dist/index.js",
    "scripts": {
        "build": "tsc",
        "build:watch": "tsc --watch",
        "clean": "rimraf dist",
        "lint": "eslint 'src/**/*.ts'",
        "lint:fix": "eslint 'src/**/*.ts' --fix",
        "format": "prettier --write 'src/**/*.ts'",
        "type-check": "tsc --noEmit",
        "test": "jest",
        "test:watch": "jest --watch",
        "test:coverage": "jest --coverage",
        "test:integration": "jest --testPathPattern=integration",
        "test:e2e": "jest --testPathPattern=e2e",
        "cdk:synth": "cdk synth",
        "cdk:deploy": "cdk deploy",
        "cdk:destroy": "cdk destroy",
        "cdk:diff": "cdk diff",
        "dev": "ts-node src/index.ts",
        "start": "node dist/index.js",
        "prepare": "husky install"
    },
    "keywords": [
        "crowdworks",
        "automation",
        "scraping",
        "aws",
        "serverless",
        "typescript"
    ],
    "author": "Your Name",
    "license": "MIT",
    "private": true,
    "engines": {
        "node": ">=18.0.0",
        "npm": ">=8.0.0"
    },
    "dependencies": {
        "aws-cdk-lib": "^2.110.0",
        "constructs": "^10.3.0",
        "aws-sdk": "^2.1490.0",
        "@aws-sdk/client-s3": "^3.450.0",
        "@aws-sdk/client-lambda": "^3.450.0",
        "@aws-sdk/client-ssm": "^3.450.0",
        "@aws-sdk/client-sns": "^3.450.0",
        "playwright": "^1.40.0",
        "openai": "^4.20.0",
        "zod": "^3.22.0",
        "source-map-support": "^0.5.21"
    },
    "devDependencies": {
        "@types/node": "^20.8.0",
        "@types/jest": "^29.5.0",
        "@types/aws-lambda": "^8.10.0",
        "@typescript-eslint/eslint-plugin": "^6.8.0",
        "@typescript-eslint/parser": "^6.8.0",
        "aws-cdk": "^2.110.0",
        "eslint": "^8.51.0",
        "eslint-config-prettier": "^9.0.0",
        "eslint-plugin-import": "^2.28.0",
        "eslint-plugin-jest": "^27.4.0",
        "jest": "^29.7.0",
        "prettier": "^3.0.0",
        "rimraf": "^5.0.0",
        "ts-jest": "^29.1.0",
        "ts-node": "^10.9.0",
        "typescript": "^5.2.0",
        "husky": "^8.0.0",
        "lint-staged": "^15.0.0",
        "aws-sdk-client-mock": "^3.0.0",
        "nock": "^13.3.0",
        "tsconfig-paths": "^4.2.0"
    },
    "husky": {
        "hooks": {
            "pre-commit": "lint-staged",
            "pre-push": "npm run type-check && npm run test"
        }
    },
    "lint-staged": {
        "src/**/*.{ts,tsx}": [
            "eslint --fix",
            "prettier --write",
            "git add"
        ]
    }
}
</file>

<file path="src/index.ts">
/**
 * CrowdWorks Search System - Main Entry Point
 * Dockerç’°å¢ƒã§ã®é–‹ç™ºç”¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
 */

import { ExecutionLog } from '@/types';

// ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼
function validateEnvironment(): void {
    const required = ['NODE_ENV', 'AWS_REGION'];
    const missing = required.filter(key => !process.env[key]);

    if (missing.length > 0) {
        throw new Error(`Missing required environment variables: ${missing.join(', ')}`);
    }
}

// ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°
async function main(): Promise<void> {
    try {
        validateEnvironment();

        const log: ExecutionLog = {
            executionId: Date.now().toString(),
            timestamp: new Date().toISOString(),
            status: 'success',
            duration: 0,
            jobsScraped: 0,
            newJobs: 0,
            aiEvaluated: 0,
            highScoreJobs: 0,
            costEstimate: 0,
        };

        console.log('ğŸš€ CrowdWorks Search System - Development Mode');
        console.log(`Environment: ${process.env.NODE_ENV}`);
        console.log(`AWS Region: ${process.env.AWS_REGION}`);
        console.log(`Execution ID: ${log.executionId}`);

        // TODO: å®Ÿéš›ã®å‡¦ç†ã‚’å®Ÿè£…
        console.log('âœ… Development setup completed');

    } catch (error) {
        console.error('âŒ Failed to start application:', error);
        process.exit(1);
    }
}

// é–‹ç™ºç’°å¢ƒã§ã®ã¿å®Ÿè¡Œ
if (require.main === module) {
    main().catch(error => {
        console.error('Fatal error:', error);
        process.exit(1);
    });
}

export { main };
</file>

<file path="src/lambda/handler.ts">
/**
 * AWS Lambda Handler for CrowdWorks Search System
 * EventBridge ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œç”¨ã®ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
 */

import type { Context } from 'aws-lambda';

import { ScheduledExecutionEvent, ScheduledExecutionResponse } from '@/types';

/**
 * Lambdaé–¢æ•°ã®ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
 * EventBridgeã‹ã‚‰ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã‚’å‡¦ç†
 */
export const lambdaHandler = async (
    event: ScheduledExecutionEvent,
    context: Context
): Promise<ScheduledExecutionResponse> => {
    const executionId = Date.now().toString();
    const startTime = Date.now();

    console.log('ğŸ”„ Lambda execution started', {
        executionId,
        functionName: context.functionName,
        remainingTimeInMillis: context.getRemainingTimeInMillis(),
        eventSource: event.source,
    });

    try {
        // TODO: ãƒ¡ã‚¤ãƒ³å‡¦ç†ã®å®Ÿè£…
        const response: ScheduledExecutionResponse = {
            status: 'success',
            executionId,
            timestamp: new Date().toISOString(),
            results: {
                jobsScraped: 0,
                newJobs: 0,
                aiEvaluated: 0,
                highScoreJobs: 0,
                duration: Date.now() - startTime,
                costEstimate: 0,
            },
        };

        console.log('âœ… Lambda execution completed', response);
        return response;

    } catch (error) {
        const errorResponse: ScheduledExecutionResponse = {
            status: 'error',
            executionId,
            timestamp: new Date().toISOString(),
            results: {
                jobsScraped: 0,
                newJobs: 0,
                aiEvaluated: 0,
                highScoreJobs: 0,
                duration: Date.now() - startTime,
                costEstimate: 0,
            },
            error: {
                type: error instanceof Error ? error.constructor.name : 'UnknownError',
                message: error instanceof Error ? error.message : String(error),
            },
        };

        console.error('âŒ Lambda execution failed', errorResponse);
        return errorResponse;
    }
};
</file>

<file path="src/types/index.ts">
// æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿å‹ï¼ˆè»½é‡ç‰ˆï¼‰
export interface JobData {
    id: string;                    // æ¡ˆä»¶IDï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰
    title: string;                 // æ¡ˆä»¶ã‚¿ã‚¤ãƒˆãƒ«
    description: string;           // æ¡ˆä»¶è©³ç´°ï¼ˆæœ€å¤§500æ–‡å­—ï¼‰
    url: string;                   // æ¡ˆä»¶URL
    budget: number;                // äºˆç®—ï¼ˆå††ï¼‰
    deadline: Date;                // ç´æœŸ
    workType: 'fixed' | 'hourly'; // å›ºå®šå ±é…¬ or æ™‚é–“å˜ä¾¡
    category: string;              // ã‚«ãƒ†ã‚´ãƒª
    clientName: string;            // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå
    clientRating: number;          // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡ï¼ˆ1-5ï¼‰
    clientReviews: number;         // ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°
    skills: string[];              // å¿…è¦ã‚¹ã‚­ãƒ«ï¼ˆæœ€å¤§5å€‹ï¼‰
    experience: 'beginner' | 'intermediate' | 'expert'; // çµŒé¨“ãƒ¬ãƒ™ãƒ«
    scrapedAt: Date;              // å–å¾—æ—¥æ™‚
    source: 'crowdworks';         // å–å¾—å…ƒï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰
}

// è©•ä¾¡çµæœå‹ï¼ˆè»½é‡ç‰ˆï¼‰
export interface JobEvaluation {
    jobId: string;                // å¯¾è±¡æ¡ˆä»¶ID
    evaluatedAt: Date;           // è©•ä¾¡æ—¥æ™‚
    score: number;               // ãŠã™ã™ã‚åº¦ï¼ˆ1-10ï¼‰
    reason: string;              // è©•ä¾¡ç†ç”±ï¼ˆæœ€å¤§50æ–‡å­—ï¼‰
    aiModel: 'gpt-3.5-turbo';    // ä½¿ç”¨AIãƒ¢ãƒ‡ãƒ«
    tokenUsed: number;           // ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³æ•°
    costEstimate: number;        // æ¨å®šã‚³ã‚¹ãƒˆï¼ˆUSDï¼‰
    strengths: string[];         // å¼·ã¿ï¼ˆæœ€å¤§3å€‹ï¼‰
    concerns: string[];          // æ‡¸å¿µç‚¹ï¼ˆæœ€å¤§3å€‹ï¼‰
}

// å®Ÿè¡Œãƒ­ã‚°å‹
export interface ExecutionLog {
    executionId: string;         // å®Ÿè¡ŒIDï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ï¼‰
    timestamp: string;           // å®Ÿè¡Œé–‹å§‹æ™‚åˆ»ï¼ˆISOå½¢å¼ï¼‰
    status: 'success' | 'error' | 'partial'; // å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    duration: number;            // å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
    jobsScraped: number;         // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ä»¶æ•°
    newJobs: number;             // æ–°è¦æ¡ˆä»¶æ•°
    aiEvaluated: number;         // AIè©•ä¾¡ä»¶æ•°
    highScoreJobs: number;       // é«˜è©•ä¾¡æ¡ˆä»¶æ•°ï¼ˆé–¾å€¤ä»¥ä¸Šï¼‰
    costEstimate: number;        // æ¨å®šã‚³ã‚¹ãƒˆï¼ˆUSDï¼‰
    error?: {
        type: string;              // ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
        message: string;           // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        stack?: string;            // ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹
    };
}

// ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå‹
export interface SystemConfig {
    scraping: {
        maxJobsPerExecution: number;
        preFilterEnabled: boolean;
        minBudget: number;
        minClientRating: number;
        maxDescriptionLength: number;
    };
    ai: {
        enabled: boolean;
        model: 'gpt-3.5-turbo';
        maxJobsForEvaluation: number;
        monthlyBudgetLimit: number;
        maxTokensPerRequest: number;
        temperature: number;
    };
    notification: {
        enabled: boolean;
        scoreThreshold: number;
        errorNotificationEnabled: boolean;
        dailySummaryEnabled: boolean;
    };
    storage: {
        retentionDays: number;
        compressionEnabled: boolean;
        backupEnabled: boolean;
    };
    performance: {
        timeoutSeconds: number;
        retryCount: number;
        concurrentLimit: number;
    };
}

// æ¤œç´¢æ¡ä»¶å‹
export interface SearchCondition {
    id: string;
    name: string;
    enabled: boolean;
    keywords: string[];
    budgetMin: number;
    budgetMax: number;
    category: string;
    workType: 'fixed' | 'hourly' | 'both';
    clientRatingMin: number;
    experienceLevel: 'beginner' | 'intermediate' | 'expert' | 'any';
    excludeKeywords: string[];
    excludeClients: string[];
}

// æ¤œç´¢æ¡ä»¶è¨­å®šå‹
export interface SearchConditions {
    version: string;
    lastUpdated: Date;
    conditions: SearchCondition[];
}

// ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼æƒ…å ±å‹
export interface LoginCredentials {
    email: string;
    password: string;
}

// Lambda ã‚¤ãƒ™ãƒ³ãƒˆå‹
export interface ScheduledExecutionEvent {
    source: 'aws.events';
    'detail-type': 'Scheduled Event';
    detail: Record<string, unknown>;
    time: string; // ISOå½¢å¼
}

// Lambda ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface ScheduledExecutionResponse {
    status: 'success' | 'error' | 'partial';
    executionId: string;
    timestamp: string;
    results: {
        jobsScraped: number;
        newJobs: number;
        aiEvaluated: number;
        highScoreJobs: number;
        duration: number;
        costEstimate: number;
    };
    error?: {
        type: string;
        message: string;
    };
}

// ã‚¨ãƒ©ãƒ¼å‹
export enum ErrorType {
    AUTHENTICATION_ERROR = 'AUTH_ERROR',
    LAMBDA_TIMEOUT = 'LAMBDA_TIMEOUT',
    S3_ACCESS_ERROR = 'S3_ACCESS_ERROR',
    SCRAPING_ERROR = 'SCRAPING_ERROR',
    AI_API_ERROR = 'AI_API_ERROR',
    NETWORK_ERROR = 'NETWORK_ERROR',
}

export class AppError extends Error {
    constructor(
        public type: ErrorType,
        message: string,
        public retryable: boolean = false
    ) {
        super(message);
        this.name = 'AppError';
    }
}
</file>

<file path="test/sample.test.ts">
/**
 * Sample test file to verify Jest configuration
 */

import { AppError, ErrorType, JobData } from '@/types';

describe('Sample Tests', () => {
    describe('Basic functionality', () => {
        it('should pass basic test', () => {
            expect(true).toBe(true);
        });

        it('should handle numbers correctly', () => {
            const result = 2 + 2;
            expect(result).toBe(4);
        });

        it('should work with async functions', async () => {
            const promise = Promise.resolve('test');
            await expect(promise).resolves.toBe('test');
        });
    });

    describe('Type definitions', () => {
        it('should create valid JobData object', () => {
            const jobData: JobData = {
                id: 'test-job-001',
                title: 'ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–',
                description: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®æ¡ˆä»¶ã§ã™',
                url: 'https://crowdworks.jp/public/jobs/test-001',
                budget: 100000,
                deadline: new Date('2024-12-31'),
                workType: 'fixed',
                category: 'ã‚·ã‚¹ãƒ†ãƒ é–‹ç™º',
                clientName: 'ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ',
                clientRating: 4.5,
                clientReviews: 10,
                skills: ['TypeScript', 'React', 'AWS'],
                experience: 'intermediate',
                scrapedAt: new Date(),
                source: 'crowdworks',
            };

            expect(jobData).toBeValidJobData();
            expect(jobData.budget).toBe(100000);
            expect(jobData.skills).toHaveLength(3);
            expect(jobData.workType).toBe('fixed');
        });

        it('should create valid AppError', () => {
            const error = new AppError(
                ErrorType.SCRAPING_ERROR,
                'Test error message',
                true
            );

            expect(error).toBeInstanceOf(Error);
            expect(error).toBeInstanceOf(AppError);
            expect(error.type).toBe(ErrorType.SCRAPING_ERROR);
            expect(error.message).toBe('Test error message');
            expect(error.retryable).toBe(true);
            expect(error.name).toBe('AppError');
        });
    });

    describe('Environment variables', () => {
        it('should have test environment variables set', () => {
            expect(process.env.NODE_ENV).toBe('test');
            expect(process.env.AWS_REGION).toBe('ap-northeast-1');
            expect(process.env.TZ).toBe('Asia/Tokyo');
        });
    });

    describe('Date handling', () => {
        it('should handle dates correctly', () => {
            const now = new Date();
            const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000);

            expect(now).toBeValidDate();
            expect(tomorrow).toBeValidDate();
            expect(tomorrow.getTime()).toBeGreaterThan(now.getTime());
        });

        it('should handle invalid dates', () => {
            const invalidDate = new Date('invalid');
            expect(invalidDate).not.toBeValidDate();
        });
    });

    describe('Custom matchers', () => {
        it('should use custom toBeValidDate matcher', () => {
            const validDate = new Date();
            const invalidDate = new Date('invalid');

            expect(validDate).toBeValidDate();
            expect(invalidDate).not.toBeValidDate();
        });

        it('should use custom toBeValidJobData matcher', () => {
            const validJob = {
                id: 'test-001',
                title: 'Test Job',
                budget: 50000,
            };

            const invalidJob = {
                title: 'Missing ID',
                budget: '50000', // wrong type
            };

            expect(validJob).toBeValidJobData();
            expect(invalidJob).not.toBeValidJobData();
        });
    });
});
</file>

<file path="test/setup.ts">
import 'jest';

// AWS SDKã®ãƒ¢ãƒƒã‚¯è¨­å®š
jest.mock('@aws-sdk/client-s3');
jest.mock('@aws-sdk/client-lambda');
jest.mock('@aws-sdk/client-ssm');
jest.mock('@aws-sdk/client-sns');

// OpenAI SDKã®ãƒ¢ãƒƒã‚¯è¨­å®š
jest.mock('openai');

// Playwrightã®ãƒ¢ãƒƒã‚¯è¨­å®š
jest.mock('playwright');

// ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
process.env.NODE_ENV = 'test';
process.env.AWS_REGION = 'ap-northeast-1';
process.env.LOG_LEVEL = 'error'; // ãƒ†ã‚¹ãƒˆä¸­ã¯ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿

// ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å›ºå®šï¼ˆãƒ†ã‚¹ãƒˆã®ä¸€è²«æ€§ã®ãŸã‚ï¼‰
process.env.TZ = 'Asia/Tokyo';

// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®åˆ¶å¾¡ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
const originalConsoleLog = console.log;
const originalConsoleWarn = console.warn;
const originalConsoleError = console.error;

beforeEach(() => {
    // å„ãƒ†ã‚¹ãƒˆå‰ã«ãƒ¢ãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢
    jest.clearAllMocks();

    // æ™‚é–“ã‚’å›ºå®šï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
    // jest.useFakeTimers();
});

afterEach(() => {
    // ãƒ†ã‚¹ãƒˆå¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    jest.clearAllTimers();
    // jest.useRealTimers();
});

// å…¨ãƒ†ã‚¹ãƒˆå¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
afterAll(() => {
    // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å¾©å…ƒ
    console.log = originalConsoleLog;
    console.warn = originalConsoleWarn;
    console.error = originalConsoleError;
});

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
declare global {
    namespace jest {
        interface Matchers<R> {
            toBeValidDate(): R;
            toBeValidJobData(): R;
        }
    }
}

// ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒãƒ£ãƒ¼ã®è¿½åŠ 
expect.extend({
    toBeValidDate(received: unknown) {
        const pass = received instanceof Date && !isNaN(received.getTime());
        return {
            message: () => `expected ${received} to be a valid Date object`,
            pass,
        };
    },

    toBeValidJobData(received: unknown) {
        const pass =
            typeof received === 'object' &&
            received !== null &&
            'id' in received &&
            'title' in received &&
            'budget' in received &&
            typeof (received as { id: unknown }).id === 'string' &&
            typeof (received as { title: unknown }).title === 'string' &&
            typeof (received as { budget: unknown }).budget === 'number';

        return {
            message: () => `expected ${JSON.stringify(received)} to be valid job data`,
            pass,
        };
    },
});
</file>

<file path="tsconfig.json">
{
    "compilerOptions": {
        "target": "ES2022",
        "module": "commonjs",
        "lib": [
            "ES2022"
        ],
        "outDir": "./dist",
        "rootDir": "./src",
        "removeComments": true,
        "declaration": true,
        "declarationMap": true,
        "sourceMap": true,
        "strict": true,
        "noImplicitAny": true,
        "strictNullChecks": true,
        "strictFunctionTypes": true,
        "strictBindCallApply": true,
        "strictPropertyInitialization": true,
        "noImplicitReturns": true,
        "noFallthroughCasesInSwitch": true,
        "noUncheckedIndexedAccess": true,
        "noImplicitOverride": true,
        "exactOptionalPropertyTypes": true,
        "noPropertyAccessFromIndexSignature": true,
        "noUnusedLocals": true,
        "noUnusedParameters": true,
        "allowUnreachableCode": false,
        "allowUnusedLabels": false,
        "esModuleInterop": true,
        "allowSyntheticDefaultImports": true,
        "forceConsistentCasingInFileNames": true,
        "moduleResolution": "node",
        "resolveJsonModule": true,
        "isolatedModules": true,
        "skipLibCheck": true,
        "experimentalDecorators": true,
        "emitDecoratorMetadata": true,
        "baseUrl": "./",
        "paths": {
            "@/*": [
                "src/*"
            ],
            "@/types/*": [
                "src/types/*"
            ],
            "@/services/*": [
                "src/services/*"
            ],
            "@/utils/*": [
                "src/utils/*"
            ],
            "@/infrastructure/*": [
                "src/infrastructure/*"
            ]
        }
    },
    "include": [
        "src/**/*",
        "test/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist",
        "cdk.out",
        "*.js"
    ],
    "ts-node": {
        "require": [
            "tsconfig-paths/register"
        ],
        "compilerOptions": {
            "module": "commonjs"
        }
    }
}
</file>

<file path="docs/03_data_design.md">
# ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ›¸

## 1. ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­è¨ˆ

### 1.1 S3ãƒã‚±ãƒƒãƒˆæ§‹é€ 

```
crowdworks-searcher-bucket/
â”œâ”€â”€ jobs/                           # æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ 2024-01-15T14-30.json     # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å½¢å¼
â”‚   â”œâ”€â”€ 2024-01-15T14-45.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ evaluations/                    # AIè©•ä¾¡çµæœ
â”‚   â”œâ”€â”€ 2024-01-15T14-30.json
â”‚   â”œâ”€â”€ 2024-01-15T14-45.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ logs/                           # å®Ÿè¡Œãƒ»ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
â”‚   â”œâ”€â”€ execution/
â”‚   â”‚   â”œâ”€â”€ 2024-01-15T14-30-execution.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ error/
â”‚   â”‚   â”œâ”€â”€ 2024-01-15T14-30-error.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ daily-summary/
â”‚       â”œâ”€â”€ 2024-01-15.json
â”‚       â””â”€â”€ ...
â””â”€â”€ config/                         # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
    â”œâ”€â”€ search-conditions.json     # æ¤œç´¢æ¡ä»¶
    â””â”€â”€ system-config.json         # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
```

### 1.2 ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡

```typescript
interface FileNamingConvention {
  jobs: 'YYYY-MM-DDTHH-mm.json';           // 2024-01-15T14-30.json
  evaluations: 'YYYY-MM-DDTHH-mm.json';   // 2024-01-15T14-30.json
  executionLogs: 'YYYY-MM-DDTHH-mm-execution.json';
  errorLogs: 'YYYY-MM-DDTHH-mm-error.json';
  dailySummary: 'YYYY-MM-DD.json';         // 2024-01-15.json
  searchConditions: 'search-conditions.json';
  systemConfig: 'system-config.json';
}
```

### 1.3 ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

```typescript
interface S3LifecyclePolicy {
  rules: [
    {
      id: 'DeleteOldData';
      status: 'Enabled';
      transitions: [];
      expiration: {
        days: 7; // 7æ—¥å¾Œè‡ªå‹•å‰Šé™¤
      };
      filter: {
        prefix: 'jobs/'; // jobs/, evaluations/, logs/ å¯¾è±¡
      };
    },
    {
      id: 'KeepConfig';
      status: 'Enabled';
      expiration: null; // config/ ã¯å‰Šé™¤ã—ãªã„
      filter: {
        prefix: 'config/';
      };
    }
  ];
}
```

## 2. ãƒ‡ãƒ¼ã‚¿å‹å®šç¾©

### 2.1 TypeScriptå‹å®šç¾©

#### 2.1.1 æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿å‹ï¼ˆè»½é‡ç‰ˆï¼‰

```typescript
interface JobData {
  // åŸºæœ¬æƒ…å ±
  id: string;                    // æ¡ˆä»¶IDï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰
  title: string;                 // æ¡ˆä»¶ã‚¿ã‚¤ãƒˆãƒ«
  description: string;           // æ¡ˆä»¶è©³ç´°ï¼ˆæœ€å¤§500æ–‡å­—ï¼‰
  url: string;                   // æ¡ˆä»¶URL
  
  // æ¡ä»¶æƒ…å ±
  budget: number;                // äºˆç®—ï¼ˆå††ï¼‰
  deadline: Date;                // ç´æœŸ
  workType: 'fixed' | 'hourly'; // å›ºå®šå ±é…¬ or æ™‚é–“å˜ä¾¡
  category: string;              // ã‚«ãƒ†ã‚´ãƒª
  
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±
  clientName: string;            // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå
  clientRating: number;          // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡ï¼ˆ1-5ï¼‰
  clientReviews: number;         // ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°
  
  // ã‚¹ã‚­ãƒ«ãƒ»è¦ä»¶
  skills: string[];              // å¿…è¦ã‚¹ã‚­ãƒ«ï¼ˆæœ€å¤§5å€‹ï¼‰
  experience: 'beginner' | 'intermediate' | 'expert'; // çµŒé¨“ãƒ¬ãƒ™ãƒ«
  
  // ãƒ¡ã‚¿æƒ…å ±
  scrapedAt: Date;              // å–å¾—æ—¥æ™‚
  source: 'crowdworks';         // å–å¾—å…ƒï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
const validateJobData = (job: JobData): boolean => {
  return (
    job.id.length > 0 &&
    job.title.length > 0 &&
    job.description.length <= 500 &&
    job.budget > 0 &&
    job.skills.length <= 5 &&
    job.clientRating >= 1 && job.clientRating <= 5
  );
};
```

#### 2.1.2 è©•ä¾¡çµæœå‹ï¼ˆè»½é‡ç‰ˆï¼‰

```typescript
interface JobEvaluation {
  // é–¢é€£æƒ…å ±
  jobId: string;                // å¯¾è±¡æ¡ˆä»¶ID
  evaluatedAt: Date;           // è©•ä¾¡æ—¥æ™‚
  
  // è©•ä¾¡çµæœ
  score: number;               // ãŠã™ã™ã‚åº¦ï¼ˆ1-10ï¼‰
  reason: string;              // è©•ä¾¡ç†ç”±ï¼ˆæœ€å¤§50æ–‡å­—ï¼‰
  
  // ãƒ¡ã‚¿æƒ…å ±
  aiModel: 'gpt-3.5-turbo';    // ä½¿ç”¨AIãƒ¢ãƒ‡ãƒ«
  tokenUsed: number;           // ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³æ•°
  costEstimate: number;        // æ¨å®šã‚³ã‚¹ãƒˆï¼ˆUSDï¼‰
  
  // è©•ä¾¡è©³ç´°ï¼ˆç°¡ç´ åŒ–ï¼‰
  strengths: string[];         // å¼·ã¿ï¼ˆæœ€å¤§3å€‹ï¼‰
  concerns: string[];          // æ‡¸å¿µç‚¹ï¼ˆæœ€å¤§3å€‹ï¼‰
}

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè©•ä¾¡ï¼ˆAIå¤±æ•—æ™‚ï¼‰
const createDefaultEvaluation = (jobId: string): JobEvaluation => ({
  jobId,
  evaluatedAt: new Date(),
  score: 5, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ã‚¢
  reason: 'AIè©•ä¾¡å¤±æ•—ã®ãŸã‚æš«å®šã‚¹ã‚³ã‚¢',
  aiModel: 'gpt-3.5-turbo',
  tokenUsed: 0,
  costEstimate: 0,
  strengths: [],
  concerns: ['AIè©•ä¾¡æœªå®Ÿæ–½']
});
```

#### 2.1.3 å®Ÿè¡Œãƒ­ã‚°å‹

```typescript
interface ExecutionLog {
  // å®Ÿè¡Œæƒ…å ±
  executionId: string;         // å®Ÿè¡ŒIDï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ï¼‰
  timestamp: string;           // å®Ÿè¡Œé–‹å§‹æ™‚åˆ»ï¼ˆISOå½¢å¼ï¼‰
  status: 'success' | 'error' | 'partial'; // å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  duration: number;            // å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
  
  // å‡¦ç†çµæœ
  jobsScraped: number;         // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ä»¶æ•°
  newJobs: number;             // æ–°è¦æ¡ˆä»¶æ•°
  aiEvaluated: number;         // AIè©•ä¾¡ä»¶æ•°
  highScoreJobs: number;       // é«˜è©•ä¾¡æ¡ˆä»¶æ•°ï¼ˆé–¾å€¤ä»¥ä¸Šï¼‰
  
  // ã‚³ã‚¹ãƒˆæƒ…å ±
  costEstimate: number;        // æ¨å®šã‚³ã‚¹ãƒˆï¼ˆUSDï¼‰
  
  // ã‚¨ãƒ©ãƒ¼æƒ…å ±ï¼ˆè©²å½“æ™‚ã®ã¿ï¼‰
  error?: {
    type: string;              // ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
    message: string;           // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    stack?: string;            // ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹
  };
}
```

#### 2.1.4 è¨­å®šå‹

```typescript
// ã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼ˆconfig/system-config.jsonï¼‰
interface SystemConfig {
  scraping: {
    maxJobsPerExecution: 50;          // æœ€å¤§å‡¦ç†ä»¶æ•°
    preFilterEnabled: true;           // äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿æœ‰åŠ¹
    minBudget: 50000;                 // æœ€ä½äºˆç®—ï¼ˆå††ï¼‰
    minClientRating: 4.0;             // æœ€ä½ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡
    maxDescriptionLength: 500;        // èª¬æ˜æ–‡æœ€å¤§é•·
  };
  
  ai: {
    enabled: true;                    // AIè©•ä¾¡æœ‰åŠ¹
    model: 'gpt-3.5-turbo';          // ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«
    maxJobsForEvaluation: 10;        // æœ€å¤§AIè©•ä¾¡ä»¶æ•°
    monthlyBudgetLimit: 3.0;         // æœˆé–“äºˆç®—åˆ¶é™ï¼ˆUSDï¼‰
    maxTokensPerRequest: 200;        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆæœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³
    temperature: 0.3;                // å¿œç­”ã®ä¸€è²«æ€§
  };
  
  notification: {
    enabled: true;                   // é€šçŸ¥æœ‰åŠ¹
    scoreThreshold: 7;               // é«˜è©•ä¾¡é–¾å€¤
    errorNotificationEnabled: true;   // ã‚¨ãƒ©ãƒ¼é€šçŸ¥æœ‰åŠ¹
    dailySummaryEnabled: true;       // æ—¥æ¬¡ã‚µãƒãƒªãƒ¼æœ‰åŠ¹
  };
  
  storage: {
    retentionDays: 7;                // ãƒ‡ãƒ¼ã‚¿ä¿æŒæ—¥æ•°
    compressionEnabled: false;        // åœ§ç¸®ç„¡åŠ¹ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
    backupEnabled: false;            // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç„¡åŠ¹ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
  };
  
  performance: {
    timeoutSeconds: 600;             // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ10åˆ†ï¼‰
    retryCount: 2;                   // ãƒªãƒˆãƒ©ã‚¤å›æ•°
    concurrentLimit: 1;              // åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™
  };
}

// æ¤œç´¢æ¡ä»¶è¨­å®šï¼ˆconfig/search-conditions.jsonï¼‰
interface SearchConditions {
  version: string;                   // è¨­å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³
  lastUpdated: Date;                 // æœ€çµ‚æ›´æ–°æ—¥æ™‚
  
  conditions: Array<{
    id: string;                      // æ¡ä»¶ID
    name: string;                    // æ¡ä»¶å
    enabled: boolean;                // æœ‰åŠ¹ãƒ•ãƒ©ã‚°
    
    // åŸºæœ¬æ¡ä»¶
    keywords: string[];              // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆæœ€å¤§10å€‹ï¼‰
    budgetMin: number;               // æœ€ä½äºˆç®—
    budgetMax: number;               // æœ€é«˜äºˆç®—
    category: string;                // ã‚«ãƒ†ã‚´ãƒª
    workType: 'fixed' | 'hourly' | 'both'; // ä½œæ¥­å½¢å¼
    
    // ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶
    clientRatingMin: number;         // æœ€ä½ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡
    experienceLevel: 'beginner' | 'intermediate' | 'expert' | 'any';
    
    // é™¤å¤–æ¡ä»¶
    excludeKeywords: string[];       // é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
    excludeClients: string[];        // é™¤å¤–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
  }>;
}
```

## 3. ãƒ‡ãƒ¼ã‚¿æ“ä½œè¨­è¨ˆ

### 3.1 S3ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹

```typescript
class S3DataService {
  private s3: S3Client;
  private bucketName: string;

  // æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿æ“ä½œ
  async saveJobs(jobs: JobData[], timestamp: string): Promise<void> {
    const key = `jobs/${timestamp}.json`;
    const body = JSON.stringify(jobs.map(this.sanitizeJobData), null, 2);
    
    await this.s3.putObject({
      Bucket: this.bucketName,
      Key: key,
      Body: body,
      ContentType: 'application/json',
      ServerSideEncryption: 'AES256',
      Metadata: {
        'job-count': jobs.length.toString(),
        'created-at': new Date().toISOString()
      }
    });
  }

  async getRecentJobs(hours: number = 24): Promise<JobData[]> {
    const cutoff = new Date(Date.now() - hours * 60 * 60 * 1000);
    const objects = await this.listObjectsSince('jobs/', cutoff);
    
    const allJobs: JobData[] = [];
    for (const obj of objects.slice(0, 10)) { // æœ€å¤§10ãƒ•ã‚¡ã‚¤ãƒ«
      const data = await this.getObject(obj.Key!);
      const jobs: JobData[] = JSON.parse(data);
      allJobs.push(...jobs);
    }
    
    return allJobs;
  }

  async getExistingJobIds(hours: number = 48): Promise<Set<string>> {
    const recentJobs = await this.getRecentJobs(hours);
    return new Set(recentJobs.map(job => job.id));
  }

  // è¨­å®šæ“ä½œ
  async getSystemConfig(): Promise<SystemConfig> {
    try {
      const data = await this.getObject('config/system-config.json');
      return JSON.parse(data);
    } catch (error) {
      return this.getDefaultSystemConfig();
    }
  }

  async getSearchConditions(): Promise<SearchConditions> {
    try {
      const data = await this.getObject('config/search-conditions.json');
      return JSON.parse(data);
    } catch (error) {
      return this.getDefaultSearchConditions();
    }
  }

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰
  private async listObjectsSince(prefix: string, since: Date): Promise<_Object[]> {
    const response = await this.s3.listObjectsV2({
      Bucket: this.bucketName,
      Prefix: prefix,
      MaxKeys: 50 // ã‚³ã‚¹ãƒˆå‰Šæ¸›
    });

    return (response.Contents || [])
      .filter(obj => obj.LastModified && obj.LastModified >= since)
      .sort((a, b) => (b.LastModified?.getTime() || 0) - (a.LastModified?.getTime() || 0));
  }

  private async getObject(key: string): Promise<string> {
    const response = await this.s3.getObject({
      Bucket: this.bucketName,
      Key: key
    });

    return response.Body?.transformToString() || '';
  }

  private sanitizeJobData(job: JobData): JobData {
    return {
      ...job,
      description: job.description.slice(0, 500), // é•·ã•åˆ¶é™
      skills: job.skills.slice(0, 5), // é…åˆ—é•·åˆ¶é™
      clientName: job.clientName.replace(/[^\w\s-]/g, '') // ç‰¹æ®Šæ–‡å­—é™¤å»
    };
  }
}
```

### 3.2 é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

```typescript
class DuplicateChecker {
  constructor(private dataService: S3DataService) {}

  async filterNewJobs(jobs: JobData[]): Promise<JobData[]> {
    // éå»48æ™‚é–“ã®ã‚¸ãƒ§ãƒ–IDã‚’å–å¾—
    const existingJobIds = await this.dataService.getExistingJobIds(48);
    
    // é‡è¤‡é™¤å¤–
    const newJobs = jobs.filter(job => !existingJobIds.has(job.id));
    
    // ã•ã‚‰ã«åŒä¸€å®Ÿè¡Œå†…ã§ã®é‡è¤‡ã‚‚ãƒã‚§ãƒƒã‚¯
    const uniqueJobs = this.removeDuplicatesInBatch(newJobs);
    
    return uniqueJobs;
  }

  private removeDuplicatesInBatch(jobs: JobData[]): JobData[] {
    const seen = new Set<string>();
    return jobs.filter(job => {
      if (seen.has(job.id)) {
        return false;
      }
      seen.add(job.id);
      return true;
    });
  }
}
```

## 4. ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ»åˆæœŸåŒ–

### 4.1 åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š

```typescript
class DataInitializer {
  constructor(private dataService: S3DataService) {}

  async initializeSystem(): Promise<void> {
    // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®åˆæœŸåŒ–
    await this.initializeSystemConfig();
    
    // æ¤œç´¢æ¡ä»¶ã®åˆæœŸåŒ–
    await this.initializeSearchConditions();
    
    // S3ãƒã‚±ãƒƒãƒˆã®è¨­å®šç¢ºèª
    await this.setupS3Bucket();
  }

  private async initializeSystemConfig(): Promise<void> {
    const defaultConfig: SystemConfig = {
      scraping: {
        maxJobsPerExecution: 50,
        preFilterEnabled: true,
        minBudget: 50000,
        minClientRating: 4.0,
        maxDescriptionLength: 500
      },
      ai: {
        enabled: true,
        model: 'gpt-3.5-turbo',
        maxJobsForEvaluation: 10,
        monthlyBudgetLimit: 3.0,
        maxTokensPerRequest: 200,
        temperature: 0.3
      },
      notification: {
        enabled: true,
        scoreThreshold: 7,
        errorNotificationEnabled: true,
        dailySummaryEnabled: true
      },
      storage: {
        retentionDays: 7,
        compressionEnabled: false,
        backupEnabled: false
      },
      performance: {
        timeoutSeconds: 600,
        retryCount: 2,
        concurrentLimit: 1
      }
    };

    await this.dataService.saveConfig('config/system-config.json', defaultConfig);
  }

  private async initializeSearchConditions(): Promise<void> {
    const defaultConditions: SearchConditions = {
      version: '1.0.0',
      lastUpdated: new Date(),
      conditions: [
        {
          id: 'web-development',
          name: 'Webã‚¢ãƒ—ãƒªé–‹ç™º',
          enabled: true,
          keywords: ['React', 'TypeScript', 'Next.js', 'Node.js'],
          budgetMin: 100000,
          budgetMax: 1000000,
          category: 'ã‚·ã‚¹ãƒ†ãƒ é–‹ç™º',
          workType: 'fixed',
          clientRatingMin: 4.0,
          experienceLevel: 'intermediate',
          excludeKeywords: ['WordPress', 'PHP'],
          excludeClients: []
        },
        {
          id: 'ai-development',
          name: 'AIãƒ»æ©Ÿæ¢°å­¦ç¿’',
          enabled: true,
          keywords: ['Python', 'AI', 'æ©Ÿæ¢°å­¦ç¿’', 'ãƒ‡ãƒ¼ã‚¿åˆ†æ'],
          budgetMin: 150000,
          budgetMax: 2000000,
          category: 'ã‚·ã‚¹ãƒ†ãƒ é–‹ç™º',
          workType: 'fixed',
          clientRatingMin: 4.5,
          experienceLevel: 'expert',
          excludeKeywords: ['Excel', 'å˜ç´”ä½œæ¥­'],
          excludeClients: []
        }
      ]
    };

    await this.dataService.saveConfig('config/search-conditions.json', defaultConditions);
  }
}
```

## 5. ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§

### 5.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ–¹é‡ï¼ˆã‚³ã‚¹ãƒˆé‡è¦–ï¼‰

```typescript
interface BackupStrategy {
  // åŸºæœ¬æ–¹é‡ï¼šã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚æœ€å°é™ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  configBackup: {
    enabled: true;
    frequency: 'on-change';  // è¨­å®šå¤‰æ›´æ™‚ã®ã¿
    retention: '30 days';
    location: 'same-bucket/backups/config/';
  };
  
  dataBackup: {
    enabled: false;          // ãƒ‡ãƒ¼ã‚¿ã¯7æ—¥ã§å‰Šé™¤ã•ã‚Œã‚‹ãŸã‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãªã—
    reason: 'Cost optimization - data has short lifecycle';
  };
  
  logBackup: {
    enabled: false;          // ãƒ­ã‚°ã‚‚7æ—¥ã§å‰Šé™¤
    reason: 'Cost optimization - short retention period';
  };
}

class BackupService {
  constructor(private dataService: S3DataService) {}

  // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¤‰æ›´æ™‚ã®ã¿ï¼‰
  async backupConfigOnChange(configType: 'system' | 'search-conditions'): Promise<void> {
    const timestamp = new Date().toISOString().split('T')[0];
    const sourceKey = `config/${configType === 'system' ? 'system-config.json' : 'search-conditions.json'}`;
    const backupKey = `backups/config/${configType}-${timestamp}.json`;

    try {
      const data = await this.dataService.getObject(sourceKey);
      await this.dataService.putObject(backupKey, data);
    } catch (error) {
      console.warn(`Config backup failed: ${error}`);
    }
  }
}
```

## 6. ãƒ‡ãƒ¼ã‚¿å“è³ªç®¡ç†

### 6.1 ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

```typescript
class DataValidator {
  // æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
  static validateJobData(job: JobData): { isValid: boolean; errors: string[] } {
    const errors: string[] = [];

    // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
    if (!job.id || job.id.trim().length === 0) {
      errors.push('Job ID is required');
    }
    if (!job.title || job.title.trim().length === 0) {
      errors.push('Job title is required');
    }
    if (!job.url || !this.isValidUrl(job.url)) {
      errors.push('Valid job URL is required');
    }

    // æ•°å€¤æ¤œè¨¼
    if (job.budget <= 0) {
      errors.push('Budget must be positive');
    }
    if (job.clientRating < 1 || job.clientRating > 5) {
      errors.push('Client rating must be between 1 and 5');
    }

    // é…åˆ—é•·åˆ¶é™
    if (job.skills.length > 5) {
      errors.push('Skills array cannot exceed 5 items');
    }
    if (job.description.length > 500) {
      errors.push('Description cannot exceed 500 characters');
    }

    // æ—¥ä»˜æ¤œè¨¼
    if (!(job.scrapedAt instanceof Date) || isNaN(job.scrapedAt.getTime())) {
      errors.push('Invalid scraped date');
    }
    if (!(job.deadline instanceof Date) || isNaN(job.deadline.getTime())) {
      errors.push('Invalid deadline');
    }

    return {
      isValid: errors.length === 0,
      errors
    };
  }

  // è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
  static validateEvaluation(evaluation: JobEvaluation): { isValid: boolean; errors: string[] } {
    const errors: string[] = [];

    if (!evaluation.jobId || evaluation.jobId.trim().length === 0) {
      errors.push('Job ID is required');
    }
    if (evaluation.score < 1 || evaluation.score > 10) {
      errors.push('Score must be between 1 and 10');
    }
    if (!evaluation.reason || evaluation.reason.length > 50) {
      errors.push('Reason must be 1-50 characters');
    }
    if (evaluation.tokenUsed < 0) {
      errors.push('Token usage cannot be negative');
    }
    if (evaluation.costEstimate < 0) {
      errors.push('Cost estimate cannot be negative');
    }

    return {
      isValid: errors.length === 0,
      errors
    };
  }

  private static isValidUrl(url: string): boolean {
    try {
      new URL(url);
      return url.includes('crowdworks.jp');
    } catch {
      return false;
    }
  }
}

// ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
class DataCleaner {
  static cleanJobData(job: JobData): JobData {
    return {
      ...job,
      title: job.title.trim().slice(0, 200),
      description: job.description.trim().slice(0, 500),
      skills: job.skills.slice(0, 5).map(skill => skill.trim()),
      clientName: job.clientName.trim().replace(/[^\w\s-]/g, ''),
      budget: Math.max(0, Math.round(job.budget)),
      clientRating: Math.max(1, Math.min(5, job.clientRating))
    };
  }

  static cleanEvaluation(evaluation: JobEvaluation): JobEvaluation {
    return {
      ...evaluation,
      score: Math.max(1, Math.min(10, Math.round(evaluation.score))),
      reason: evaluation.reason.trim().slice(0, 50),
      strengths: evaluation.strengths.slice(0, 3),
      concerns: evaluation.concerns.slice(0, 3),
      tokenUsed: Math.max(0, evaluation.tokenUsed),
      costEstimate: Math.max(0, evaluation.costEstimate)
    };
  }
}
```

**ã“ã‚Œã§S3ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ›¸ãŒå®Œæˆã—ã¾ã—ãŸï¼**

ã‚³ã‚¹ãƒˆåˆ¶ç´„ï¼ˆæœˆ$5ä»¥ä¸‹ï¼‰ã‚’æº€ãŸã—ãªãŒã‚‰ã€å¿…è¦ãªæ©Ÿèƒ½ã‚’æä¾›ã§ãã‚‹è»½é‡ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ã€‚
</file>

<file path="docs/04_api_design.md">
# APIè¨­è¨ˆæ›¸

## 1. APIæ¦‚è¦

### 1.1 APIæ–¹é‡

**åŸºæœ¬æ–¹é‡**
- **ã‚³ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: æœˆ$5ä»¥ä¸‹ã®äºˆç®—åˆ¶ç´„ã‚’æœ€å„ªå…ˆ
- **ã‚µãƒ¼ãƒãƒ¬ã‚¹ä¸­å¿ƒ**: Lambdaé–¢æ•°é–“ã®è»½é‡ãªå†…éƒ¨API
- **å¤–éƒ¨APIæœ€å°é™**: ChatGPT APIï¼ˆè»½é‡åˆ©ç”¨ï¼‰ã¨ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®ã¿
- **RESTfulè¨­è¨ˆ**: æ¨™æº–çš„ãªHTTPãƒ¡ã‚½ãƒƒãƒ‰ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
- **JSONå½¢å¼**: å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯JSON
- **å‹å®‰å…¨æ€§**: TypeScriptã§ã®å®Œå…¨ãªå‹å®šç¾©

**APIæ§‹æˆ**
- **å†…éƒ¨API**: Lambdaé–¢æ•°é–“ã®é€£æºï¼ˆEventBridge + ç›´æ¥å‘¼ã³å‡ºã—ï¼‰
- **ç®¡ç†ç”¨API**: è¨­å®šç¢ºèªãƒ»æ‰‹å‹•å®Ÿè¡Œç”¨ã®æœ€å°é™APIï¼ˆAPI Gatewayï¼‰
- **å¤–éƒ¨API**: ChatGPT APIã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- **é€šçŸ¥API**: SNS/SESã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãƒ»é«˜è©•ä¾¡æ¡ˆä»¶é€šçŸ¥

### 1.2 èªè¨¼æ–¹å¼

**å†…éƒ¨APIèªè¨¼**
```typescript
// Lambdaé–¢æ•°é–“: IAMãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹èªè¨¼
interface LambdaInvocationAuth {
  type: 'IAM_ROLE';
  role: 'arn:aws:iam::account:role/CrowdWorksSearcherRole';
  permissions: ['lambda:InvokeFunction', 's3:GetObject', 's3:PutObject'];
}

// EventBridge: ã‚µãƒ¼ãƒ“ã‚¹é–“èªè¨¼
interface EventBridgeAuth {
  type: 'SERVICE_PRINCIPAL';
  principal: 'events.amazonaws.com';
  targetFunction: 'CrowdWorksSearcherMainFunction';
}
```

**å¤–éƒ¨APIèªè¨¼**
```typescript
// Parameter Store ã§ã®å®‰å…¨ãªç®¡ç†
interface ExternalAPIAuth {
  chatgpt: {
    type: 'Bearer Token';
    storage: 'AWS Systems Manager Parameter Store';
    path: '/crowdworks-searcher/secrets/openai-api-key';
    encryption: 'SecureString';
  };
  
  crowdworks: {
    type: 'Session Cookie';
    storage: 'AWS Systems Manager Parameter Store';
    credentials: {
      email: '/crowdworks-searcher/secrets/crowdworks-email';
      password: '/crowdworks-searcher/secrets/crowdworks-password';
    };
    encryption: 'SecureString';
  };
}
```

### 1.3 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…±é€šä»•æ§˜

```typescript
// æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface APIErrorResponse {
  error: {
    code: string;           // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
    message: string;        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    timestamp: string;      // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»ï¼ˆISOå½¢å¼ï¼‰
    requestId: string;      // ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹ç”¨ï¼‰
    retryable: boolean;     // ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ã‹ã©ã†ã‹
    details?: Record<string, any>; // è©³ç´°æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  };
}

// ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šç¾©
enum APIErrorCode {
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ (4xx)
  INVALID_REQUEST = 'INVALID_REQUEST',
  AUTHENTICATION_FAILED = 'AUTHENTICATION_FAILED',
  AUTHORIZATION_FAILED = 'AUTHORIZATION_FAILED',
  RESOURCE_NOT_FOUND = 'RESOURCE_NOT_FOUND',
  RATE_LIMIT_EXCEEDED = 'RATE_LIMIT_EXCEEDED',
  
  // ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ (5xx)
  INTERNAL_SERVER_ERROR = 'INTERNAL_SERVER_ERROR',
  SERVICE_UNAVAILABLE = 'SERVICE_UNAVAILABLE',
  EXTERNAL_API_ERROR = 'EXTERNAL_API_ERROR',
  TIMEOUT_ERROR = 'TIMEOUT_ERROR',
  
  // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼
  BUDGET_EXCEEDED = 'BUDGET_EXCEEDED',
  SCRAPING_FAILED = 'SCRAPING_FAILED',
  AI_EVALUATION_FAILED = 'AI_EVALUATION_FAILED',
  S3_OPERATION_FAILED = 'S3_OPERATION_FAILED'
}
```

## 2. å†…éƒ¨APIè¨­è¨ˆ

### 2.1 ãƒ¡ã‚¤ãƒ³å‡¦ç†APIï¼ˆLambdaé–¢æ•°ï¼‰

#### 2.1.1 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ

```typescript
// EventBridge â†’ Lambdaå®Ÿè¡Œ
interface ScheduledExecutionEvent {
  source: 'aws.events';
  'detail-type': 'Scheduled Event';
  detail: {};
  time: string; // ISOå½¢å¼
}

interface ScheduledExecutionResponse {
  status: 'success' | 'error' | 'partial';
  executionId: string;
  timestamp: string;
  results: {
    jobsScraped: number;
    newJobs: number;
    aiEvaluated: number;
    highScoreJobs: number;
    duration: number;
    costEstimate: number;
  };
  error?: {
    type: string;
    message: string;
  };
}

// Lambda Handlerå®Ÿè£…
export const scheduledExecutionHandler = async (
  event: ScheduledExecutionEvent
): Promise<ScheduledExecutionResponse> => {
  const executionId = Date.now().toString();
  const startTime = Date.now();
  
  try {
    // ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œ
    const result = await executeMainFlow(executionId);
    
    return {
      status: 'success',
      executionId,
      timestamp: new Date().toISOString(),
      results: {
        ...result,
        duration: Date.now() - startTime
      }
    };
  } catch (error) {
    return {
      status: 'error',
      executionId,
      timestamp: new Date().toISOString(),
      results: {
        jobsScraped: 0,
        newJobs: 0,
        aiEvaluated: 0,
        highScoreJobs: 0,
        duration: Date.now() - startTime,
        costEstimate: 0
      },
      error: {
        type: error.constructor.name,
        message: error.message
      }
    };
  }
};
```

#### 2.1.2 æ‰‹å‹•å®Ÿè¡ŒAPI

```typescript
// ç·Šæ€¥æ™‚ã®æ‰‹å‹•å®Ÿè¡Œç”¨ï¼ˆAPI GatewayçµŒç”±ï¼‰
interface ManualExecutionRequest {
  trigger: 'manual';
  options?: {
    skipCache?: boolean;     // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ã‚­ãƒƒãƒ—
    forceAIEvaluation?: boolean; // AIè©•ä¾¡å¼·åˆ¶å®Ÿè¡Œ
    testMode?: boolean;      // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰
  };
}

interface ManualExecutionResponse {
  message: string;
  executionId: string;
  estimatedCompletion: string; // å®Œäº†äºˆå®šæ™‚åˆ»
  monitorUrl?: string;         // å®Ÿè¡ŒçŠ¶æ³ç¢ºèªURLï¼ˆS3ãƒ­ã‚°ï¼‰
}

// POST /api/execute
export const manualExecutionHandler = async (
  event: APIGatewayProxyEvent
): Promise<APIGatewayProxyResult> => {
  try {
    const request: ManualExecutionRequest = JSON.parse(event.body || '{}');
    
    // Lambdaé–¢æ•°ã‚’éåŒæœŸå®Ÿè¡Œ
    const executionId = await invokeLambdaAsync('main-function', {
      source: 'manual',
      options: request.options
    });
    
    const response: ManualExecutionResponse = {
      message: 'Execution started successfully',
      executionId,
      estimatedCompletion: new Date(Date.now() + 60000).toISOString(),
      monitorUrl: `s3://bucket/logs/execution/${executionId}.json`
    };
    
    return {
      statusCode: 202,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(response)
    };
  } catch (error) {
    return createErrorResponse(APIErrorCode.INTERNAL_SERVER_ERROR, error.message);
  }
};
```

### 2.2 è¨­å®šç®¡ç†API

#### 2.2.1 ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå–å¾—

```typescript
// GET /api/config/system
interface SystemConfigResponse {
  config: SystemConfig;
  lastModified: string;
  version: string;
}

export const getSystemConfigHandler = async (): Promise<APIGatewayProxyResult> => {
  try {
    const s3DataService = new S3DataService();
    const config = await s3DataService.getSystemConfig();
    
    const response: SystemConfigResponse = {
      config,
      lastModified: new Date().toISOString(),
      version: '1.0.0'
    };
    
    return {
      statusCode: 200,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(response)
    };
  } catch (error) {
    return createErrorResponse(APIErrorCode.S3_OPERATION_FAILED, error.message);
  }
};
```

#### 2.2.2 æ¤œç´¢æ¡ä»¶ç®¡ç†

```typescript
// GET /api/config/search-conditions
interface SearchConditionsResponse {
  conditions: SearchConditions;
  activeCount: number;
  lastModified: string;
}

// PUT /api/config/search-conditions
interface UpdateSearchConditionsRequest {
  conditions: SearchConditions;
  backupCurrent?: boolean; // ç¾åœ¨ã®è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
}

export const getSearchConditionsHandler = async (): Promise<APIGatewayProxyResult> => {
  try {
    const s3DataService = new S3DataService();
    const conditions = await s3DataService.getSearchConditions();
    
    const activeCount = conditions.conditions.filter(c => c.enabled).length;
    
    const response: SearchConditionsResponse = {
      conditions,
      activeCount,
      lastModified: conditions.lastUpdated.toISOString()
    };
    
    return {
      statusCode: 200,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(response)
    };
  } catch (error) {
    return createErrorResponse(APIErrorCode.S3_OPERATION_FAILED, error.message);
  }
};
```

### 2.3 ãƒ‡ãƒ¼ã‚¿å–å¾—API

#### 2.3.1 æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿å–å¾—

```typescript
// GET /api/jobs?hours=24&limit=50
interface JobsQuery {
  hours?: number;    // éå»ä½•æ™‚é–“ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 24ï¼‰
  limit?: number;    // æœ€å¤§å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
  minScore?: number; // æœ€ä½ã‚¹ã‚³ã‚¢
}

interface JobsResponse {
  jobs: JobData[];
  totalCount: number;
  timeRange: {
    from: string;
    to: string;
  };
  hasMore: boolean;
}

export const getJobsHandler = async (
  event: APIGatewayProxyEvent
): Promise<APIGatewayProxyResult> => {
  try {
    const query: JobsQuery = event.queryStringParameters || {};
    const hours = parseInt(query.hours || '24');
    const limit = parseInt(query.limit || '50');
    const minScore = query.minScore ? parseFloat(query.minScore) : undefined;
    
    const s3DataService = new S3DataService();
    let jobs = await s3DataService.getRecentJobs(hours);
    
    // ã‚¹ã‚³ã‚¢ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ï¼ˆè©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã¨çµåˆï¼‰
    if (minScore !== undefined) {
      const evaluations = await s3DataService.getRecentEvaluations(hours);
      const highScoreJobIds = new Set(
        evaluations.filter(e => e.score >= minScore).map(e => e.jobId)
      );
      jobs = jobs.filter(job => highScoreJobIds.has(job.id));
    }
    
    // ãƒšãƒ¼ã‚¸ãƒ³ã‚°
    const paginatedJobs = jobs.slice(0, limit);
    const hasMore = jobs.length > limit;
    
    const response: JobsResponse = {
      jobs: paginatedJobs,
      totalCount: jobs.length,
      timeRange: {
        from: new Date(Date.now() - hours * 60 * 60 * 1000).toISOString(),
        to: new Date().toISOString()
      },
      hasMore
    };
    
    return {
      statusCode: 200,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(response)
    };
  } catch (error) {
    return createErrorResponse(APIErrorCode.S3_OPERATION_FAILED, error.message);
  }
};
```

#### 2.3.2 å®Ÿè¡ŒçŠ¶æ³å–å¾—

```typescript
// GET /api/status
interface SystemStatusResponse {
  status: 'healthy' | 'degraded' | 'unhealthy';
  lastExecution: {
    id: string;
    timestamp: string;
    status: string;
    duration: number;
    results: {
      jobsScraped: number;
      newJobs: number;
      highScoreJobs: number;
    };
  } | null;
  nextExecution: string; // æ¬¡å›å®Ÿè¡Œäºˆå®šæ™‚åˆ»
  monthlyStats: {
    executions: number;
    totalJobs: number;
    totalCost: number;
    budgetRemaining: number;
  };
  alerts: string[]; // ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§
}

export const getSystemStatusHandler = async (): Promise<APIGatewayProxyResult> => {
  try {
    const s3DataService = new S3DataService();
    
    // æœ€æ–°ã®å®Ÿè¡Œãƒ­ã‚°ã‚’å–å¾—
    const lastExecution = await s3DataService.getLatestExecutionLog();
    
    // æœˆæ¬¡çµ±è¨ˆã‚’è¨ˆç®—
    const monthlyStats = await calculateMonthlyStats();
    
    // ã‚·ã‚¹ãƒ†ãƒ å¥åº·çŠ¶æ…‹ã‚’åˆ¤å®š
    const status = determineSystemHealth(lastExecution, monthlyStats);
    
    // ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
    const alerts = await checkSystemAlerts(monthlyStats);
    
    const response: SystemStatusResponse = {
      status,
      lastExecution: lastExecution ? {
        id: lastExecution.executionId,
        timestamp: lastExecution.timestamp,
        status: lastExecution.status,
        duration: lastExecution.duration,
        results: {
          jobsScraped: lastExecution.jobsScraped,
          newJobs: lastExecution.newJobs,
          highScoreJobs: lastExecution.highScoreJobs
        }
      } : null,
      nextExecution: getNextExecutionTime(),
      monthlyStats,
      alerts
    };
    
    return {
      statusCode: 200,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(response)
    };
  } catch (error) {
    return createErrorResponse(APIErrorCode.INTERNAL_SERVER_ERROR, error.message);
  }
};
```

## 3. å¤–éƒ¨APIé€£æº

### 3.1 ChatGPT APIé€£æº

```typescript
// OpenAI APIæ¥ç¶šè¨­å®š
interface ChatGPTAPIConfig {
  baseURL: 'https://api.openai.com/v1';
  model: 'gpt-3.5-turbo';
  maxTokens: 200;
  temperature: 0.3;
  timeout: 30000; // 30ç§’
}

// APIå‘¼ã³å‡ºã—ã‚µãƒ¼ãƒ“ã‚¹
class ChatGPTAPIService {
  private client: OpenAI;
  private rateLimiter: RateLimiter;
  private costTracker: CostTracker;

  constructor(apiKey: string) {
    this.client = new OpenAI({ apiKey });
    this.rateLimiter = new RateLimiter({
      requestsPerMinute: 50,  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
      requestsPerHour: 1000
    });
    this.costTracker = new CostTracker({
      monthlyLimit: 3.0 // $3/æœˆåˆ¶é™
    });
  }

  async evaluateJob(job: JobData): Promise<JobEvaluation> {
    // ã‚³ã‚¹ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
    if (this.costTracker.isOverLimit()) {
      throw new Error('Monthly AI budget exceeded');
    }

    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
    await this.rateLimiter.waitIfNeeded();

    try {
      const prompt = this.createEvaluationPrompt(job);
      
      const response = await this.client.chat.completions.create({
        model: 'gpt-3.5-turbo',
        messages: [{ role: 'user', content: prompt }],
        max_tokens: 200,
        temperature: 0.3,
        response_format: { type: 'json_object' }
      });

      const content = response.choices[0]?.message?.content;
      if (!content) {
        throw new Error('Empty response from ChatGPT API');
      }

      const evaluation = this.parseEvaluationResponse(content, job.id);
      
      // ã‚³ã‚¹ãƒˆè¿½è·¡
      const cost = this.calculateCost(response.usage);
      this.costTracker.addUsage(cost);
      
      return {
        ...evaluation,
        tokenUsed: response.usage?.total_tokens || 0,
        costEstimate: cost
      };

    } catch (error) {
      if (error.status === 429) {
        throw new APIError(APIErrorCode.RATE_LIMIT_EXCEEDED, 'ChatGPT API rate limit exceeded');
      }
      if (error.status >= 500) {
        throw new APIError(APIErrorCode.EXTERNAL_API_ERROR, 'ChatGPT API server error');
      }
      throw new APIError(APIErrorCode.AI_EVALUATION_FAILED, error.message);
    }
  }

  private createEvaluationPrompt(job: JobData): string {
    return `
æ¡ˆä»¶ã‚’è©•ä¾¡ã—ã¦JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š

æ¡ˆä»¶æƒ…å ±:
- ã‚¿ã‚¤ãƒˆãƒ«: ${job.title}
- äºˆç®—: ${job.budget.toLocaleString()}å††
- ç´æœŸ: ${job.deadline.toLocaleDateString()}
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡: ${job.clientRating}/5.0
- å¿…è¦ã‚¹ã‚­ãƒ«: ${job.skills.join(', ')}
- æ¦‚è¦: ${job.description.slice(0, 200)}

è©•ä¾¡åŸºæº–:
1. äºˆç®—ã®å¦¥å½“æ€§ï¼ˆç›¸å ´ã¨ã®æ¯”è¼ƒï¼‰
2. ã‚¹ã‚­ãƒ«ãƒãƒƒãƒãƒ³ã‚°åº¦
3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¿¡é ¼æ€§
4. æ¡ˆä»¶èª¬æ˜ã®æ˜ç¢ºæ€§
5. ç´æœŸã®ç¾å®Ÿæ€§

å›ç­”å½¢å¼:
{
  "score": 1-10ã®æ•´æ•°,
  "reason": "è©•ä¾¡ç†ç”±ï¼ˆ50æ–‡å­—ä»¥å†…ï¼‰",
  "strengths": ["å¼·ã¿1", "å¼·ã¿2"],
  "concerns": ["æ‡¸å¿µ1", "æ‡¸å¿µ2"]
}
`;
  }

  private parseEvaluationResponse(content: string, jobId: string): JobEvaluation {
    try {
      const parsed = JSON.parse(content);
      
      return {
        jobId,
        evaluatedAt: new Date(),
        score: Math.max(1, Math.min(10, parseInt(parsed.score))),
        reason: (parsed.reason || '').slice(0, 50),
        aiModel: 'gpt-3.5-turbo',
        tokenUsed: 0, // å¾Œã§è¨­å®š
        costEstimate: 0, // å¾Œã§è¨­å®š
        strengths: (parsed.strengths || []).slice(0, 3),
        concerns: (parsed.concerns || []).slice(0, 3)
      };
    } catch (error) {
      // ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè©•ä¾¡
      return createDefaultEvaluation(jobId);
    }
  }

  private calculateCost(usage: any): number {
    const inputTokens = usage?.prompt_tokens || 0;
    const outputTokens = usage?.completion_tokens || 0;
    
    // GPT-3.5-turbo pricing: $0.0015/1K input, $0.002/1K output
    return (inputTokens * 0.0015 + outputTokens * 0.002) / 1000;
  }
}
```

### 3.2 ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°

```typescript
// ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š
interface ScrapingConfig {
  baseURL: 'https://crowdworks.jp';
  userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36';
  timeout: 30000;
  retryCount: 3;
  retryDelay: 2000;
}

// ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°API
class CrowdWorksScrapingService {
  private browser: Browser | null = null;
  private page: Page | null = null;
  private isAuthenticated: boolean = false;

  async initialize(): Promise<void> {
    try {
      this.browser = await playwright.chromium.launch({
        headless: true,
        args: ['--no-sandbox', '--disable-setuid-sandbox'] // Lambdaç”¨è¨­å®š
      });

      this.page = await this.browser.newPage({
        userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
      });

      // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
      this.page.setDefaultTimeout(30000);
      
    } catch (error) {
      throw new APIError(APIErrorCode.SCRAPING_FAILED, `Browser initialization failed: ${error.message}`);
    }
  }

  async authenticate(credentials: { email: string; password: string }): Promise<void> {
    if (!this.page) {
      throw new APIError(APIErrorCode.SCRAPING_FAILED, 'Browser not initialized');
    }

    try {
      // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ç§»å‹•
      await this.page.goto('https://crowdworks.jp/login');
      
      // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
      await this.page.fill('input[name="email"]', credentials.email);
      await this.page.fill('input[name="password"]', credentials.password);
      
      // ãƒ­ã‚°ã‚¤ãƒ³å®Ÿè¡Œ
      await this.page.click('button[type="submit"]');
      
      // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç¢ºèª
      await this.page.waitForURL('**/dashboard', { timeout: 10000 });
      
      this.isAuthenticated = true;
      
    } catch (error) {
      throw new APIError(APIErrorCode.AUTHENTICATION_FAILED, `CrowdWorks login failed: ${error.message}`);
    }
  }

  async searchJobs(conditions: SearchCondition[]): Promise<JobData[]> {
    if (!this.isAuthenticated || !this.page) {
      throw new APIError(APIErrorCode.AUTHENTICATION_FAILED, 'Not authenticated');
    }

    const allJobs: JobData[] = [];

    for (const condition of conditions) {
      if (!condition.enabled) continue;

      try {
        const jobs = await this.searchWithCondition(condition);
        allJobs.push(...jobs);
        
        // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œï¼ˆæ¤œç´¢é–“éš”ï¼‰
        await this.delay(2000);
        
      } catch (error) {
        console.warn(`Search failed for condition ${condition.id}:`, error.message);
        // å€‹åˆ¥ã®æ¤œç´¢å¤±æ•—ã¯å…¨ä½“ã‚’æ­¢ã‚ãªã„
      }
    }

    return allJobs;
  }

  private async searchWithCondition(condition: SearchCondition): Promise<JobData[]> {
    if (!this.page) throw new Error('Page not available');

    const jobs: JobData[] = [];

    try {
      // æ¤œç´¢ãƒšãƒ¼ã‚¸ã«ç§»å‹•
      await this.page.goto('https://crowdworks.jp/projects/search');
      
      // æ¤œç´¢æ¡ä»¶è¨­å®š
      await this.setSearchFilters(condition);
      
      // æ¤œç´¢å®Ÿè¡Œ
      await this.page.click('button[type="submit"]');
      await this.page.waitForSelector('.project-item', { timeout: 10000 });
      
      // æ¡ˆä»¶ãƒªã‚¹ãƒˆå–å¾—
      const jobElements = await this.page.$$('.project-item');
      
      for (const element of jobElements.slice(0, 20)) { // æœ€å¤§20ä»¶
        try {
          const jobData = await this.extractJobData(element);
          if (jobData && this.validateJobData(jobData)) {
            jobs.push(jobData);
          }
        } catch (error) {
          console.warn('Failed to extract job data:', error.message);
        }
      }
      
    } catch (error) {
      throw new APIError(APIErrorCode.SCRAPING_FAILED, `Search failed: ${error.message}`);
    }

    return jobs;
  }

  async cleanup(): Promise<void> {
    if (this.page) {
      await this.page.close();
      this.page = null;
    }
    if (this.browser) {
      await this.browser.close();
      this.browser = null;
    }
    this.isAuthenticated = false;
  }
}
```

## 4. é€šçŸ¥APIè¨­è¨ˆ

### 4.1 SNSé€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹

```typescript
// SNSé€šçŸ¥è¨­å®š
interface NotificationConfig {
  errorTopic: string;          // ã‚¨ãƒ©ãƒ¼é€šçŸ¥ç”¨SNSãƒˆãƒ”ãƒƒã‚¯
  highScoreTopic: string;      // é«˜è©•ä¾¡æ¡ˆä»¶é€šçŸ¥ç”¨
  email: string;               // é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  enabled: boolean;            // é€šçŸ¥æœ‰åŠ¹ãƒ•ãƒ©ã‚°
}

// é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹
class NotificationService {
  private sns: SNSClient;
  private ses: SESClient;
  private config: NotificationConfig;

  constructor(config: NotificationConfig) {
    this.sns = new SNSClient({});
    this.ses = new SESClient({});
    this.config = config;
  }

  // ã‚¨ãƒ©ãƒ¼é€šçŸ¥
  async sendErrorAlert(error: Error, executionId: string): Promise<void> {
    if (!this.config.enabled) return;

    const message = {
      timestamp: new Date().toISOString(),
      executionId,
      errorType: error.constructor.name,
      errorMessage: error.message,
      severity: this.determineSeverity(error)
    };

    try {
      await this.sns.publish({
        TopicArn: this.config.errorTopic,
        Subject: `[CrowdWorks Searcher] ${message.severity} Error`,
        Message: JSON.stringify(message, null, 2)
      });
    } catch (snsError) {
      console.error('Failed to send error notification:', snsError);
    }
  }

  // é«˜è©•ä¾¡æ¡ˆä»¶é€šçŸ¥
  async sendHighScoreAlert(jobs: JobEvaluation[]): Promise<void> {
    if (!this.config.enabled || jobs.length === 0) return;

    const message = {
      timestamp: new Date().toISOString(),
      jobCount: jobs.length,
      jobs: jobs.map(job => ({
        jobId: job.jobId,
        score: job.score,
        reason: job.reason
      }))
    };

    try {
      await this.sns.publish({
        TopicArn: this.config.highScoreTopic,
        Subject: `[CrowdWorks Searcher] ${jobs.length} High Score Job(s) Found`,
        Message: JSON.stringify(message, null, 2)
      });
    } catch (snsError) {
      console.error('Failed to send high score notification:', snsError);
    }
  }
}
```

## 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å…±é€šå®Ÿè£…

```typescript
// ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼
export const createErrorResponse = (
  errorCode: APIErrorCode,
  message: string,
  details?: Record<string, any>
): APIGatewayProxyResult => {
  const error: APIErrorResponse = {
    error: {
      code: errorCode,
      message,
      timestamp: new Date().toISOString(),
      requestId: uuidv4(),
      retryable: isRetryableError(errorCode),
      details
    }
  };

  return {
    statusCode: ERROR_STATUS_MAP[errorCode] || 500,
    headers: {
      'Content-Type': 'application/json',
      'X-Request-ID': error.error.requestId
    },
    body: JSON.stringify(error)
  };
};

// ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
export class APIError extends Error {
  constructor(
    public code: APIErrorCode,
    message: string,
    public retryable: boolean = false,
    public details?: Record<string, any>
  ) {
    super(message);
    this.name = 'APIError';
  }
}

// ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ã‚¨ãƒ©ãƒ¼ã®åˆ¤å®š
const isRetryableError = (errorCode: APIErrorCode): boolean => {
  return [
    APIErrorCode.SERVICE_UNAVAILABLE,
    APIErrorCode.TIMEOUT_ERROR,
    APIErrorCode.EXTERNAL_API_ERROR,
    APIErrorCode.RATE_LIMIT_EXCEEDED
  ].includes(errorCode);
};
```
</file>

<file path="docs/01_requirements.md">
# è¦ä»¶å®šç¾©æ›¸

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹æ¡ˆä»¶è‡ªå‹•æ¤œç´¢ãƒ»è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆCrowdWorks Auto Job Searcherï¼‰

### 1.2 ç›®çš„ãƒ»èƒŒæ™¯
ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ä¸Šã§é©åˆ‡ãªæ¡ˆä»¶ã‚’åŠ¹ç‡çš„ã«ç™ºè¦‹ã—ã€æ¡ˆä»¶ã®å“è³ªã‚„ãƒãƒƒãƒãƒ³ã‚°åº¦ã‚’è‡ªå‹•è©•ä¾¡ã™ã‚‹ã“ã¨ã§ã€ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚µãƒ¼ã®æ¡ˆä»¶é¸å®šæ¥­å‹™ã‚’è‡ªå‹•åŒ–ãƒ»åŠ¹ç‡åŒ–ã™ã‚‹ã€‚

**èƒŒæ™¯**
- æ‰‹å‹•ã§ã®æ¡ˆä»¶ãƒã‚§ãƒƒã‚¯ã¯æ™‚é–“ãŒã‹ã‹ã‚‹
- è‰¯ã„æ¡ˆä»¶ã‚’è¦‹é€ƒã™ãƒªã‚¹ã‚¯ãŒã‚ã‚‹
- æ¡ˆä»¶ã®è©•ä¾¡ã«ä¸»è¦³ãŒå…¥ã‚Šã‚„ã™ã„
- å®šæœŸçš„ãªãƒã‚§ãƒƒã‚¯ãŒå›°é›£
- å€‹äººåˆ©ç”¨ã§ã®ã‚³ã‚¹ãƒˆåŠ¹ç‡æ€§ã‚’é‡è¦–

### 1.3 ã‚¹ã‚³ãƒ¼ãƒ—
**å¯¾è±¡ç¯„å›²**
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ä¸Šã®æ¡ˆä»¶æƒ…å ±ã®è‡ªå‹•å–å¾—
- AIï¼ˆChatGPTï¼‰ã«ã‚ˆã‚‹æ¡ˆä»¶è©•ä¾¡
- æ¤œç´¢æ¡ä»¶ã®ç®¡ç†ãƒ»ä¿å­˜
- å®šæœŸå®Ÿè¡Œã«ã‚ˆã‚‹ç¶™ç¶šç›£è¦–
- AWSã‚µãƒ¼ãƒãƒ¬ã‚¹ç’°å¢ƒã§ã®é‹ç”¨
- ç›´è¿‘1é€±é–“ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆæ¡ˆä»¶ã®closeãŒæ—©ã„ãŸã‚ï¼‰

**å¯¾è±¡å¤–**
- ä»–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚½ãƒ¼ã‚·ãƒ³ã‚°ã‚µã‚¤ãƒˆ
- æ¡ˆä»¶ã¸ã®è‡ªå‹•å¿œå‹Ÿæ©Ÿèƒ½
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®ã‚„ã‚Šå–ã‚Šè‡ªå‹•åŒ–
- ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã§ã®é‹ç”¨
- é•·æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ

## 2. æ©Ÿèƒ½è¦ä»¶

### 2.1 Mustï¼ˆå¿…é ˆæ©Ÿèƒ½ï¼‰
- **æ¤œç´¢æ¡ä»¶ç®¡ç†æ©Ÿèƒ½**
  - æ¤œç´¢æ¡ä»¶ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ï¼ˆS3 JSONå½¢å¼ï¼‰
  - è¤‡æ•°ã®æ¤œç´¢æ¡ä»¶ã‚»ãƒƒãƒˆã®ç®¡ç†
- **è‡ªå‹•å–å¾—æ©Ÿèƒ½**
  - 15åˆ†é–“éš”ã§ã®è‡ªå‹•å®Ÿè¡Œï¼ˆEventBridgeï¼‰
  - AWSã‚µãƒ¼ãƒãƒ¬ã‚¹ç’°å¢ƒã§ã®å®‰å®šå‹•ä½œ
  - ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•æ“ä½œã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆPlaywright on Lambdaï¼‰
- **AIè©•ä¾¡æ©Ÿèƒ½ï¼ˆè»½é‡ç‰ˆï¼‰**
  - ChatGPT APIã‚’ä½¿ç”¨ã—ãŸæ¡ˆä»¶è©•ä¾¡ï¼ˆäº‹å‰ãƒ•ã‚£ãƒ«ã‚¿å¾Œï¼‰
  - ãŠã™ã™ã‚åº¦ã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆ1-10ç‚¹ï¼‰
  - è©•ä¾¡ç†ç”±ã®æ–‡ç« ç”Ÿæˆ
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½**
  - å–å¾—ã—ãŸæ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ï¼ˆS3 JSONå½¢å¼ï¼‰
  - è©•ä¾¡çµæœã®å±¥æ­´ä¿å­˜ï¼ˆ1é€±é–“ï¼‰
  - é‡è¤‡æ¡ˆä»¶ã®æ¤œå‡ºãƒ»é™¤å¤–ï¼ˆéå»24-48æ™‚é–“åˆ†ï¼‰

### 2.2 Shouldï¼ˆé‡è¦æ©Ÿèƒ½ï¼‰
- **é€šçŸ¥æ©Ÿèƒ½**
  - é«˜è©•ä¾¡æ¡ˆä»¶ã®å³åº§é€šçŸ¥ï¼ˆSNS/SESï¼‰
  - å®Ÿè¡Œã‚¨ãƒ©ãƒ¼æ™‚ã®é€šçŸ¥
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½**
  - äºˆç®—ç¯„å›²ã§ã®çµã‚Šè¾¼ã¿
  - ã‚¹ã‚­ãƒ«ã‚»ãƒƒãƒˆãƒãƒƒãƒãƒ³ã‚°
  - ç´æœŸæ¡ä»¶ã§ã®ãƒ•ã‚£ãƒ«ã‚¿
- **ãƒ­ã‚°ãƒ»ç›£è¦–æ©Ÿèƒ½**
  - å®Ÿè¡Œãƒ­ã‚°ã®è¨˜éŒ²ï¼ˆS3 JSONå½¢å¼ï¼‰
  - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®é€šçŸ¥
  - æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ç”Ÿæˆ

### 2.3 Couldï¼ˆã‚ã‚Œã°è‰¯ã„æ©Ÿèƒ½ï¼‰
- **ç°¡æ˜“ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½**
  - é€±æ¬¡ã®æ¡ˆä»¶å‹•å‘ã‚µãƒãƒªãƒ¼
  - é«˜è©•ä¾¡æ¡ˆä»¶ã®å‚¾å‘åˆ†æ
- **Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**
  - S3ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é™çš„ã‚µã‚¤ãƒˆï¼ˆVercelç­‰ï¼‰
  - è¨­å®šå¤‰æ›´ç”¨ã®ç°¡æ˜“UI

## 3. éæ©Ÿèƒ½è¦ä»¶

### 3.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
- 15åˆ†é–“éš”ã§ã®å®Ÿè¡Œã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
- Lambdaé–¢æ•°ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: æœ€å¤§10åˆ†
- 1å›ã®å®Ÿè¡Œã§æœ€å¤§50ä»¶ã®æ¡ˆä»¶ã‚’å‡¦ç†
- å®Ÿè¡Œæ™‚é–“1åˆ†ä»¥å†…ã‚’ç›®æ¨™ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ï¼‰
- AIè©•ä¾¡ã¯é«˜ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«æ¡ˆä»¶ã®ã¿ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰

### 3.2 å¯ç”¨æ€§è¦ä»¶
- AWSã‚µãƒ¼ãƒãƒ¬ã‚¹ç’°å¢ƒã§ã®24æ™‚é–“365æ—¥ç¨¼åƒ
- ã‚·ã‚¹ãƒ†ãƒ éšœå®³æ™‚ã®è‡ªå‹•å¾©æ—§æ©Ÿèƒ½
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³æ™‚ã®ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ï¼ˆæœ€å¤§3å›ï¼‰
- ç¨¼åƒç‡: 95%ä»¥ä¸Šï¼ˆå€‹äººåˆ©ç”¨ãƒ¬ãƒ™ãƒ«ï¼‰

### 3.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
- AWS Systems Manager Parameter Store ã§ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†
- IAMãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹æœ€å°æ¨©é™ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- S3ãƒã‚±ãƒƒãƒˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆè¨­å®š
- å–å¾—ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·ï¼ˆS3æš—å·åŒ–ï¼‰
- ãƒ­ã‚°ã®æ©Ÿå¯†æƒ…å ±ãƒã‚¹ã‚­ãƒ³ã‚°

### 3.4 é‹ç”¨ãƒ»ä¿å®ˆæ€§è¦ä»¶
- S3ã§ã®æ§‹é€ åŒ–ãƒ­ã‚°ç®¡ç†
- AWS CDK ã§ã® Infrastructure as Code
- Lambdaé–¢æ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- ã‚¨ãƒ©ãƒ¼æ™‚ã®SNSé€šçŸ¥
- 7æ—¥é–“ã®è‡ªå‹•ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆS3 Lifecycle Policyï¼‰

### 3.5 ã‚³ã‚¹ãƒˆè¦ä»¶
- **æœˆé¡é‹ç”¨ã‚³ã‚¹ãƒˆ: $5ä»¥ä¸‹ã‚’å³å®ˆ**
- Lambdaå®Ÿè¡Œæ™‚é–“ã®æœ€é©åŒ–ï¼ˆ1åˆ†ä»¥å†…ï¼‰
- S3ä½¿ç”¨é‡ã®æœ€å°åŒ–
- CloudWatchä½¿ç”¨ã®å®Œå…¨å»ƒæ­¢
- ChatGPT APIä½¿ç”¨é‡ã®åˆ¶é™ï¼ˆäº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰

## 4. åˆ¶ç´„äº‹é …

### 4.1 æŠ€è¡“çš„åˆ¶ç´„
- AWS ã‚µãƒ¼ãƒãƒ¬ã‚¹ç’°å¢ƒã§ã®é–‹ç™ºãƒ»é‹ç”¨
- TypeScript ã§ã®å‹å®‰å…¨æ€§ç¢ºä¿ï¼ˆanyå‹ã®ä½¿ç”¨ç¦æ­¢ï¼‰
- Lambdaé–¢æ•°ã®å®Ÿè¡Œæ™‚é–“åˆ¶é™ï¼ˆæœ€å¤§10åˆ†ï¼‰
- Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªåˆ¶é™
- S3ã§ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆNoSQLæ©Ÿèƒ½ãªã—ï¼‰
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã®åˆ©ç”¨è¦ç´„éµå®ˆ

### 4.2 é‹ç”¨åˆ¶ç´„
- ChatGPT API ã®åˆ©ç”¨æ–™é‡‘åˆ¶é™ï¼ˆæœˆ$3ä»¥ä¸‹ï¼‰
- AWS ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨æ–™é‡‘åˆ¶é™ï¼ˆæœˆ$2ä»¥ä¸‹ï¼‰
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹é »åº¦åˆ¶é™
- 1æ—¥ã‚ãŸã‚Šã®æœ€å¤§å®Ÿè¡Œå›æ•°: 96å›ï¼ˆ15åˆ†Ã—4Ã—24æ™‚é–“ï¼‰
- LambdaåŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™
- ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“: æœ€å¤§7æ—¥é–“

### 4.3 ãã®ä»–åˆ¶ç´„
- å€‹äººåˆ©ç”¨ç›®çš„ã«é™å®š
- å•†ç”¨åˆ©ç”¨ã¯åˆ¥é€”æ¤œè¨ãŒå¿…è¦
- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾è±¡ã‚µã‚¤ãƒˆã®ä»•æ§˜å¤‰æ›´ãƒªã‚¹ã‚¯
- AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åˆ©ç”¨å¯èƒ½ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åˆ¶é™
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†ææ©Ÿèƒ½ãªã—

## 5. å‰ææ¡ä»¶
- AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆæ¸ˆã¿
- é©åˆ‡ãªIAMæ¨©é™ãŒè¨­å®šæ¸ˆã¿
- ChatGPT API ã‚­ãƒ¼ãŒå–å¾—æ¸ˆã¿
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆæ¸ˆã¿
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå®‰å®šã—ã¦ã„ã‚‹
- AWS CLI/CDK ã®å®Ÿè¡Œç’°å¢ƒ
- æ¡ˆä»¶ã¯1é€±é–“ç¨‹åº¦ã§closeã™ã‚‹ãŸã‚çŸ­æœŸãƒ‡ãƒ¼ã‚¿ç®¡ç†ã§ååˆ†

## 6. ç”¨èªå®šç¾©
| ç”¨èª | å®šç¾© |
|------|------|
| æ¡ˆä»¶ | ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ä¸Šã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ä»•äº‹ã®ä¾é ¼ |
| æ¤œç´¢æ¡ä»¶ | æ¡ˆä»¶ã‚’çµã‚Šè¾¼ã‚€ãŸã‚ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š |
| è©•ä¾¡ã‚¹ã‚³ã‚¢ | AI ãŒç®—å‡ºã™ã‚‹æ¡ˆä»¶ã®ãŠã™ã™ã‚åº¦ï¼ˆ1-10ç‚¹ï¼‰ |
| å®Ÿè¡Œå±¥æ­´ | ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•å®Ÿè¡Œã—ãŸè¨˜éŒ² |
| ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° | ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•æ“ä½œã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å–å¾— |
| ã‚µãƒ¼ãƒãƒ¬ã‚¹ | AWS Lambdaç­‰ã®ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ä¸è¦ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ |
| EventBridge | AWSã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæ—§CloudWatch Eventsï¼‰ |
| äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ | AIè©•ä¾¡å‰ã®äºˆç®—ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç­‰ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿ |
| TTL | Time To Liveã€S3ã§ã®è‡ªå‹•å‰Šé™¤è¨­å®š |
</file>

<file path="docs/02_system_design.md">
# ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚             AWS Cloud                â”‚
                        â”‚                                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    EventBridge (15åˆ†é–“éš”)                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 Lambda Function (Main)                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚ Scheduler   â”‚  â”‚   Scraper    â”‚  â”‚   AI Evaluator   â”‚    â”‚
    â”‚  â”‚   Logic     â”‚â”€â–¶â”‚ (Playwright) â”‚â”€â–¶â”‚  (ChatGPT API)   â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                       â”‚
                           â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     S3 Bucket                â”‚               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚
    â”‚  â”‚ jobs/           â”‚  â”‚   logs/         â”‚   â”‚               â”‚
    â”‚  â”‚ (æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿)      â”‚  â”‚ (å®Ÿè¡Œãƒ­ã‚°)       â”‚   â”‚               â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚
    â”‚  â”‚ evaluations/    â”‚  â”‚  config/        â”‚   â”‚               â”‚
    â”‚  â”‚ (è©•ä¾¡çµæœ)        â”‚  â”‚ (è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«)    â”‚   â”‚               â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                           â”‚                                       â”‚
                           â–¼                                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                 æ”¯æ´ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæœ€å°æ§‹æˆï¼‰
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Parameter Store â”‚  â”‚      SNS        â”‚
    â”‚  â”‚  (Secrets)      â”‚  â”‚ (Error Notify)  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ External Servicesâ”‚
                    â”‚ - CrowdWorks     â”‚
                    â”‚ - ChatGPT API    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–¹é‡

- **ã‚³ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: æœˆ$5ä»¥ä¸‹ã®å³æ ¼ãªã‚³ã‚¹ãƒˆåˆ¶ç´„ã‚’æœ€å„ªå…ˆ
- **S3ä¸­å¿ƒè¨­è¨ˆ**: ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ»ãƒ­ã‚°ãƒ»è¨­å®šã‚’ã™ã¹ã¦S3ã§ç®¡ç†
- **ã‚·ãƒ³ãƒ—ãƒ«ãƒ»è»½é‡**: è¤‡é›‘ãªæ©Ÿèƒ½ã‚’æ’é™¤ã—ã€ã‚³ã‚¢æ©Ÿèƒ½ã«é›†ä¸­
- **äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: AIè©•ä¾¡å‰ã®çµã‚Šè¾¼ã¿ã§ã‚³ã‚¹ãƒˆå‰Šæ¸›
- **çŸ­æœŸãƒ‡ãƒ¼ã‚¿ç®¡ç†**: 7æ—¥é–“ã®TTLã§è‡ªå‹•å‰Šé™¤
- **å‹å®‰å…¨æ€§**: TypeScript strict ãƒ¢ãƒ¼ãƒ‰ã§å®Œå…¨ãªå‹å®šç¾©

### 1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

**ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**
- **AWS Lambda** (Node.js 18.x): ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œç’°å¢ƒ
- **EventBridge**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ï¼ˆ15åˆ†é–“éš”ï¼‰
- **AWS CDK** (TypeScript): Infrastructure as Code

**ãƒ‡ãƒ¼ã‚¿ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**
- **S3**: å…¨ãƒ‡ãƒ¼ã‚¿ã®ä¸€å…ƒç®¡ç†ï¼ˆæ¡ˆä»¶ãƒ»ãƒ­ã‚°ãƒ»è¨­å®šãƒ»è©•ä¾¡çµæœï¼‰
- **S3 Lifecycle Policy**: 7æ—¥å¾Œè‡ªå‹•å‰Šé™¤
- **Parameter Store**: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã®ã¿

**è¨€èªãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**
- **TypeScript** (v5ä»¥ä¸Š): å‹å®‰å…¨æ€§ç¢ºä¿ã€anyå‹ä½¿ç”¨ç¦æ­¢
- **Playwright**: ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–ï¼ˆLambda Layerï¼‰
- **AWS SDK v3**: AWS ã‚µãƒ¼ãƒ“ã‚¹é€£æº
- **OpenAI SDK**: ChatGPTé€£æºï¼ˆè»½é‡åˆ©ç”¨ï¼‰

**ç›£è¦–ãƒ»é‹ç”¨ï¼ˆæœ€å°æ§‹æˆï¼‰**
- **SNS**: ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®ã¿
- **S3ãƒ™ãƒ¼ã‚¹ãƒ­ã‚°**: æ§‹é€ åŒ–JSONå½¢å¼

## 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 2.1 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼

**è²¬å‹™**
- EventBridge ã‹ã‚‰ã®ãƒˆãƒªã‚¬ãƒ¼å—ä¿¡
- Lambdaé–¢æ•°ã®å®Ÿè¡Œåˆ¶å¾¡
- å®Ÿè¡Œæ™‚é–“ã®æœ€é©åŒ–ï¼ˆ1åˆ†ä»¥å†…ç›®æ¨™ï¼‰

**å®Ÿè£…æ–¹å¼**
```typescript
// EventBridge Rule
const scheduleRule = new events.Rule(this, 'ScheduleRule', {
  schedule: events.Schedule.rate(Duration.minutes(15)),
  targets: [new targets.LambdaFunction(mainFunction)]
});

interface SchedulerEvent {
  source: 'aws.events';
  'detail-type': 'Scheduled Event';
  detail: {};
}
```

### 2.2 ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼

**è²¬å‹™**
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã¸ã®è»½é‡ã‚¢ã‚¯ã‚»ã‚¹
- åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿æŠ½å‡ºï¼ˆæœ€å¤§50ä»¶/å›ï¼‰
- äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ

**è»½é‡åŒ–è¨­è¨ˆ**
```typescript
interface IScrapperService {
  authenticateUser(credentials: LoginCredentials): Promise<void>;
  searchJobsLight(condition: SearchCondition): Promise<JobData[]>;
  applyPreFilter(jobs: JobData[]): JobData[]; // AIè©•ä¾¡å‰ãƒ•ã‚£ãƒ«ã‚¿
  validateJobData(job: JobData): boolean;
}

// äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä¾‹
const applyPreFilter = (jobs: JobData[]): JobData[] => {
  return jobs.filter(job => 
    job.budget >= 50000 &&           // æœ€ä½äºˆç®—
    job.clientRating >= 4.0 &&       // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡
    hasTargetSkills(job.skills) &&   // ã‚¹ã‚­ãƒ«ãƒãƒƒãƒãƒ³ã‚°
    isReasonableDeadline(job.deadline) // ç´æœŸãƒã‚§ãƒƒã‚¯
  );
};
```

### 2.3 ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆS3ãƒ™ãƒ¼ã‚¹ï¼‰

**è²¬å‹™**
- S3ã§ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- JSONå½¢å¼ã§ã®ã‚·ãƒ³ãƒ—ãƒ«ãªèª­ã¿æ›¸ã
- TTLæ©Ÿèƒ½ã«ã‚ˆã‚‹è‡ªå‹•å‰Šé™¤

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ è¨­è¨ˆ**
```typescript
// S3 Bucketæ§‹é€ 
interface S3Structure {
  'jobs/': {
    pattern: 'YYYY-MM-DDTHH-mm.json';
    example: '2024-01-15T14-30.json';
    ttl: '7 days';
  };
  'evaluations/': {
    pattern: 'YYYY-MM-DDTHH-mm.json';
    example: '2024-01-15T14-30.json';
    ttl: '7 days';
  };
  'logs/': {
    execution: 'YYYY-MM-DDTHH-mm-execution.json';
    error: 'YYYY-MM-DDTHH-mm-error.json';
    daily: 'daily-summary/YYYY-MM-DD.json';
    ttl: '7 days';
  };
  'config/': {
    searchConditions: 'search-conditions.json';
    system: 'system-config.json';
    ttl: 'none';
  };
}

// ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚µãƒ¼ãƒ“ã‚¹
class S3DataService {
  async saveJobs(jobs: JobData[]): Promise<void> {
    const timestamp = new Date().toISOString().slice(0, 16);
    await this.s3.putObject({
      Bucket: this.bucketName,
      Key: `jobs/${timestamp}.json`,
      Body: JSON.stringify(jobs, null, 2),
      ServerSideEncryption: 'AES256'
    }).promise();
  }

  async getRecentJobs(hours: number = 24): Promise<JobData[]> {
    const cutoff = new Date(Date.now() - hours * 60 * 60 * 1000);
    const objects = await this.listObjectsSince('jobs/', cutoff);
    
    const allJobs: JobData[] = [];
    for (const obj of objects) {
      const data = await this.getObject(obj.Key);
      allJobs.push(...JSON.parse(data));
    }
    return allJobs;
  }

  async getExistingJobIds(hours: number = 48): Promise<Set<string>> {
    const recentJobs = await this.getRecentJobs(hours);
    return new Set(recentJobs.map(job => job.id));
  }
}
```

### 2.4 AIè©•ä¾¡ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆè»½é‡ç‰ˆï¼‰

**è²¬å‹™**
- äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿æ¡ˆä»¶ã®ã¿è©•ä¾¡
- ãƒãƒƒãƒå‡¦ç†ã§ã®åŠ¹ç‡åŒ–
- ã‚³ã‚¹ãƒˆç›£è¦–æ©Ÿèƒ½

**è»½é‡å®Ÿè£…**
```typescript
class LightAIEvaluatorService {
  private monthlyUsage: number = 0;
  private readonly MONTHLY_LIMIT = 3; // $3/æœˆåˆ¶é™

  async evaluateFilteredJobs(jobs: JobData[]): Promise<JobEvaluation[]> {
    // ã‚³ã‚¹ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
    if (this.monthlyUsage >= this.MONTHLY_LIMIT) {
      throw new Error('Monthly AI budget exceeded');
    }

    // æœ€é‡è¦æ¡ˆä»¶ã®ã¿è©•ä¾¡ï¼ˆã•ã‚‰ãªã‚‹çµã‚Šè¾¼ã¿ï¼‰
    const priorityJobs = this.selectPriorityJobs(jobs);
    
    const evaluations: JobEvaluation[] = [];
    for (const job of priorityJobs) {
      try {
        const evaluation = await this.evaluateJob(job);
        evaluations.push(evaluation);
        
        // ä½¿ç”¨é‡è¿½è·¡
        this.monthlyUsage += this.estimateTokenCost(job);
        
      } catch (error) {
        // AIè©•ä¾¡å¤±æ•—æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ã‚¢
        evaluations.push(this.createDefaultEvaluation(job));
      }
    }
    
    return evaluations;
  }

  private selectPriorityJobs(jobs: JobData[]): JobData[] {
    return jobs
      .sort((a, b) => b.budget - a.budget) // é«˜äºˆç®—é †
      .slice(0, 10); // ä¸Šä½10ä»¶ã®ã¿
  }

  private estimateTokenCost(job: JobData): number {
    const tokenCount = (job.title.length + job.description.length) / 4;
    return tokenCount * 0.002 / 1000; // GPT-3.5-turboä¾¡æ ¼
  }
}
```

### 2.5 è¨­å®šç®¡ç†ï¼ˆS3ãƒ™ãƒ¼ã‚¹ï¼‰

**è²¬å‹™**
- S3ã§ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- Parameter Store ã§ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†
- è»½é‡ãªè¨­å®šèª­ã¿è¾¼ã¿

**è¨­å®šæ§‹é€ **
```typescript
// config/system-config.json
interface SystemConfig {
  scraping: {
    maxJobsPerExecution: 50;
    preFilterEnabled: true;
    minBudget: 50000;
    minClientRating: 4.0;
  };
  ai: {
    enabled: true;
    model: 'gpt-3.5-turbo';
    maxJobsForEvaluation: 10;
    monthlyBudgetLimit: 3.0;
  };
  notification: {
    enabled: true;
    scoreThreshold: 7;
    errorNotificationEnabled: true;
  };
  storage: {
    retentionDays: 7;
    compressionEnabled: false;
  };
}

// config/search-conditions.json
interface SearchConditions {
  conditions: Array<{
    id: string;
    name: string;
    keywords: string[];
    budgetMin: number;
    budgetMax: number;
    category: string;
    workType: 'fixed' | 'hourly';
    enabled: boolean;
  }>;
}
```

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 3.1 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```
EventBridge â”€â”€15åˆ†â”€â”€â–¶ Lambda Function (Main Handler)
                            â”‚
                            â–¼
                    Parameter Store â”€â”€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå–å¾—â”€â”€â–¶ Scraper Service
                            â”‚                              â”‚
                            â–¼                              â–¼
                    S3 Config â—€â”€â”€è¨­å®šèª­ã¿è¾¼ã¿â”€â”€â”€â”€â”€â”€â”€â”€ CrowdWorks Site
                    (search-conditions.json)           â”‚
                            â”‚                          â–¼
                            â–¼                     æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿å–å¾—
                    S3 Jobs â—€â”€â”€é‡è¤‡ãƒã‚§ãƒƒã‚¯â”€â”€â”€â”€â”€â”€ Pre-Filter
                    (éå»48æ™‚é–“åˆ†)                    â”‚
                            â”‚                          â–¼
                            â–¼                     æ–°è¦æ¡ˆä»¶
                    S3 Jobs â—€â”€â”€â”€â”€æ–°è¦æ¡ˆä»¶ä¿å­˜â”€â”€â”€â”€ Light AI Evaluator
                    (timestamp.json)                  â”‚
                            â”‚                          â–¼
                            â–¼                     è©•ä¾¡çµæœ
                    S3 Evaluations â—€â”€â”€è©•ä¾¡ä¿å­˜â”€â”€â”€ High Score Filter
                    (timestamp.json)                  â”‚
                            â”‚                          â–¼
                            â–¼                     é€šçŸ¥åˆ¤å®š
                    S3 Logs â—€â”€â”€â”€â”€å®Ÿè¡Œãƒ­ã‚°â”€â”€â”€â”€â”€â”€ SNS Notification
                    (execution.json)              (ã‚¨ãƒ©ãƒ¼ãƒ»é«˜è©•ä¾¡)
```

### 3.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼

**æœ€é©åŒ–ã•ã‚ŒãŸãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ãƒ­ãƒ¼**
```typescript
export const handler = async (event: SchedulerEvent): Promise<void> => {
  const executionId = Date.now().toString();
  const startTime = Date.now();
  const timestamp = new Date().toISOString().slice(0, 16);
  
  const log: ExecutionLog = {
    executionId,
    timestamp,
    status: 'success',
    duration: 0,
    jobsScraped: 0,
    newJobs: 0,
    aiEvaluated: 0,
    highScoreJobs: 0,
    costEstimate: 0
  };

  try {
    // 1. è¨­å®šã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå–å¾—ï¼ˆä¸¦åˆ—ï¼‰
    const [config, credentials] = await Promise.all([
      s3DataService.getSystemConfig(),
      parameterService.getCredentials()
    ]);

    // 2. é‡è¤‡ãƒã‚§ãƒƒã‚¯ç”¨ãƒ‡ãƒ¼ã‚¿å–å¾—
    const existingJobIds = await s3DataService.getExistingJobIds(48);

    // 3. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè¡Œ
    const scraper = new ScraperService(credentials);
    const allJobs = await scraper.searchJobsLight(config.searchConditions);
    log.jobsScraped = allJobs.length;

    // 4. é‡è¤‡æ’é™¤
    const newJobs = allJobs.filter(job => !existingJobIds.has(job.id));
    log.newJobs = newJobs.length;

    if (newJobs.length === 0) {
      log.duration = Date.now() - startTime;
      await s3DataService.saveExecutionLog(log, timestamp);
      return; // æ–°è¦æ¡ˆä»¶ãªã—ã§çµ‚äº†
    }

    // 5. æ–°è¦æ¡ˆä»¶ä¿å­˜
    await s3DataService.saveJobs(newJobs, timestamp);

    // 6. äº‹å‰ãƒ•ã‚£ãƒ«ã‚¿å®Ÿè¡Œ
    const filteredJobs = scraper.applyPreFilter(newJobs);

    // 7. AIè©•ä¾¡ï¼ˆãƒ•ã‚£ãƒ«ã‚¿å¾Œã®å„ªå…ˆæ¡ˆä»¶ã®ã¿ï¼‰
    let evaluations: JobEvaluation[] = [];
    if (config.ai.enabled && filteredJobs.length > 0) {
      const aiEvaluator = new LightAIEvaluatorService();
      evaluations = await aiEvaluator.evaluateFilteredJobs(filteredJobs);
      log.aiEvaluated = evaluations.length;
      log.costEstimate = aiEvaluator.getSessionCost();

      // 8. è©•ä¾¡çµæœä¿å­˜
      await s3DataService.saveEvaluations(evaluations, timestamp);
    }

    // 9. é«˜è©•ä¾¡æ¡ˆä»¶é€šçŸ¥
    const highScoreJobs = evaluations.filter(e => e.score >= config.notification.scoreThreshold);
    log.highScoreJobs = highScoreJobs.length;

    if (highScoreJobs.length > 0) {
      await notificationService.sendHighScoreAlert(highScoreJobs);
    }

    // 10. å®Ÿè¡Œãƒ­ã‚°ä¿å­˜
    log.duration = Date.now() - startTime;
    await s3DataService.saveExecutionLog(log, timestamp);

  } catch (error) {
    log.status = 'error';
    log.error = {
      type: error.constructor.name,
      message: error.message,
      stack: error.stack
    };
    log.duration = Date.now() - startTime;

    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ä¿å­˜
    await s3DataService.saveErrorLog(log, timestamp);

    // é‡è¦ã‚¨ãƒ©ãƒ¼ã®é€šçŸ¥
    if (shouldNotifyError(error)) {
      await notificationService.sendErrorAlert(error, executionId);
    }

    throw error; // Lambdaå¤±æ•—ã¨ã—ã¦è¨˜éŒ²
  }
};
```

## 4. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 å¤–éƒ¨APIé€£æº

**ChatGPT APIï¼ˆè»½é‡ç‰ˆï¼‰**
```typescript
interface LightChatGPTRequest {
  model: 'gpt-3.5-turbo'; // GPT-4ã¯ä½¿ç”¨ã—ãªã„ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
  messages: ChatCompletionMessage[];
  max_tokens: 200; // çŸ­ç¸®
  temperature: 0.3; // ä¸€è²«æ€§é‡è¦–
  response_format: { type: 'json_object' };
}

const LIGHT_EVALUATION_PROMPT = `
æ¡ˆä»¶ã‚’ç°¡æ½”ã«è©•ä¾¡ã—ã¦ãã ã•ã„ï¼ˆäºˆç®—:{budget}å††ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè©•ä¾¡:{clientRating}ï¼‰ï¼š

{title}

ã‚¹ã‚­ãƒ«: {skills}
è©³ç´°: {description}

JSONå½¢å¼ã§å›ç­”:
{"score": 1-10, "reason": "50æ–‡å­—ä»¥å†…"}
`;
```

### 4.2 å†…éƒ¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**è»½é‡åŒ–ãƒ‡ãƒ¼ã‚¿å‹**
```typescript
interface JobData {
  id: string;
  title: string;
  description: string; // 500æ–‡å­—ã¾ã§
  budget: number;
  deadline: Date;
  clientRating: number;
  skills: string[]; // æœ€å¤§5å€‹
  url: string;
  scrapedAt: Date;
}

interface JobEvaluation {
  jobId: string;
  score: number; // 1-10
  reason: string; // 50æ–‡å­—ä»¥å†…
  evaluatedAt: Date;
  tokenUsed: number; // ã‚³ã‚¹ãƒˆè¿½è·¡
}

interface ExecutionLog {
  executionId: string;
  timestamp: string;
  status: 'success' | 'error' | 'partial';
  duration: number;
  jobsScraped: number;
  newJobs: number;
  aiEvaluated: number;
  highScoreJobs: number;
  costEstimate: number;
  error?: {
    type: string;
    message: string;
    stack?: string;
  };
}
```

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 5.1 èªè¨¼ãƒ»èªå¯ï¼ˆæœ€å°æ¨©é™ï¼‰

**IAM ãƒ­ãƒ¼ãƒ«è¨­è¨ˆ**
```typescript
const lambdaRole = new iam.Role(this, 'LambdaExecutionRole', {
  assumedBy: new iam.ServicePrincipal('lambda.amazonaws.com'),
  managedPolicies: [
    iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSLambdaBasicExecutionRole')
  ],
  inlinePolicies: {
    S3Access: new iam.PolicyDocument({
      statements: [
        new iam.PolicyStatement({
          effect: iam.Effect.ALLOW,
          actions: [
            's3:GetObject',
            's3:PutObject',
            's3:ListBucket'
          ],
          resources: [
            s3Bucket.bucketArn,
            `${s3Bucket.bucketArn}/*`
          ]
        })
      ]
    }),
    ParameterStoreAccess: new iam.PolicyDocument({
      statements: [
        new iam.PolicyStatement({
          effect: iam.Effect.ALLOW,
          actions: ['ssm:GetParameter'],
          resources: [`arn:aws:ssm:${region}:${account}:parameter/crowdworks-searcher/secrets`]
        })
      ]
    }),
    SNSAccess: new iam.PolicyDocument({
      statements: [
        new iam.PolicyStatement({
          effect: iam.Effect.ALLOW,
          actions: ['sns:Publish'],
          resources: [errorTopic.topicArn]
        })
      ]
    })
  }
});
```

### 5.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·

**S3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**
```typescript
const s3Bucket = new s3.Bucket(this, 'CrowdWorksSearcherBucket', {
  encryption: s3.BucketEncryption.S3_MANAGED,
  blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
  lifecycleRules: [
    {
      id: 'DeleteOldData',
      enabled: true,
      expiration: Duration.days(7), // 7æ—¥å¾Œè‡ªå‹•å‰Šé™¤
      abortIncompleteMultipartUploadAfter: Duration.days(1)
    }
  ],
  versioning: false, // ã‚³ã‚¹ãƒˆå‰Šæ¸›
  removalPolicy: RemovalPolicy.DESTROY
});
```

## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ

### 6.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡ï¼ˆç°¡ç´ åŒ–ï¼‰

```typescript
export enum ErrorType {
  // é‡è¦ã‚¨ãƒ©ãƒ¼ï¼ˆé€šçŸ¥å¿…è¦ï¼‰
  AUTHENTICATION_ERROR = 'AUTH_ERROR',
  LAMBDA_TIMEOUT = 'LAMBDA_TIMEOUT',
  S3_ACCESS_ERROR = 'S3_ACCESS_ERROR',
  
  // è»½å¾®ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ­ã‚°ã®ã¿ï¼‰
  SCRAPING_ERROR = 'SCRAPING_ERROR',
  AI_API_ERROR = 'AI_API_ERROR',
  NETWORK_ERROR = 'NETWORK_ERROR'
}

export class LightAppError extends Error {
  constructor(
    public type: ErrorType,
    message: string,
    public retryable: boolean = false
  ) {
    super(message);
  }
}
```

### 6.2 ã‚¨ãƒ©ãƒ¼å‡¦ç†æ–¹é‡

**è»½é‡ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```typescript
class LightRetryHandler {
  async executeWithRetry<T>(
    operation: () => Promise<T>,
    maxRetries: number = 2 // å‰Šæ¸›
  ): Promise<T> {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await operation();
      } catch (error) {
        if (attempt === maxRetries) throw error;
        await this.sleep(1000 * attempt); // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒƒã‚¯ã‚ªãƒ•
      }
    }
    throw new Error('Max retries exceeded');
  }
}

const shouldNotifyError = (error: Error): boolean => {
  const criticalErrors = [
    'AUTHENTICATION_ERROR',
    'LAMBDA_TIMEOUT', 
    'S3_ACCESS_ERROR'
  ];
  return criticalErrors.includes(error.constructor.name);
};
```

## 7. ãƒ­ã‚°è¨­è¨ˆï¼ˆS3ãƒ™ãƒ¼ã‚¹ï¼‰

### 7.1 S3ãƒ­ã‚°æ§‹é€ 

```typescript
interface S3LogStructure {
  'logs/execution/': {
    pattern: 'YYYY-MM-DDTHH-mm-execution.json';
    content: ExecutionLog;
    retention: '7 days';
  };
  'logs/error/': {
    pattern: 'YYYY-MM-DDTHH-mm-error.json';
    content: ExecutionLog; // status = 'error'
    retention: '7 days';
  };
  'logs/daily-summary/': {
    pattern: 'YYYY-MM-DD.json';
    content: DailySummary;
    retention: '7 days';
  };
}

interface DailySummary {
  date: string;
  totalExecutions: number;
  successfulExecutions: number;
  totalJobsFound: number;
  totalNewJobs: number;
  averageScore: number;
  highScoreJobs: number;
  totalAICost: number;
  errors: string[];
}
```

### 7.2 ãƒ­ã‚°å®Ÿè£…

**è»½é‡ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹**
```typescript
class S3LogService {
  async saveExecutionLog(log: ExecutionLog, timestamp: string): Promise<void> {
    await this.s3.putObject({
      Bucket: this.bucketName,
      Key: `logs/execution/${timestamp}-execution.json`,
      Body: JSON.stringify(log, null, 2),
      ContentType: 'application/json'
    }).promise();
  }

  async saveErrorLog(log: ExecutionLog, timestamp: string): Promise<void> {
    await this.s3.putObject({
      Bucket: this.bucketName,
      Key: `logs/error/${timestamp}-error.json`,
      Body: JSON.stringify(log, null, 2),
      ContentType: 'application/json'
    }).promise();
  }

  async generateDailySummary(date: string): Promise<DailySummary> {
    const dayLogs = await this.getLogsForDate(date);
    
    return {
      date,
      totalExecutions: dayLogs.length,
      successfulExecutions: dayLogs.filter(l => l.status === 'success').length,
      totalJobsFound: dayLogs.reduce((sum, l) => sum + l.jobsScraped, 0),
      totalNewJobs: dayLogs.reduce((sum, l) => sum + l.newJobs, 0),
      averageScore: this.calculateAverageScore(dayLogs),
      highScoreJobs: dayLogs.reduce((sum, l) => sum + l.highScoreJobs, 0),
      totalAICost: dayLogs.reduce((sum, l) => sum + l.costEstimate, 0),
      errors: dayLogs.filter(l => l.error).map(l => l.error!.message)
    };
  }
}
```

## 8. ã‚³ã‚¹ãƒˆæœ€é©åŒ–æˆ¦ç•¥

### 8.1 ã‚³ã‚¹ãƒˆç›£è¦–

```typescript
interface CostMonitor {
  trackLambdaExecution(duration: number, memoryMB: number): void;
  trackS3Operations(operations: S3Operation[]): void;
  trackAIUsage(tokens: number, model: string): void;
  generateMonthlyCostReport(): MonthlyCostReport;
}

interface MonthlyCostReport {
  lambda: { executions: number; cost: number };
  s3: { operations: number; storage: number; cost: number };
  ai: { tokens: number; cost: number };
  other: { sns: number; parameterStore: number };
  total: number;
  budgetRemaining: number;
}
```

### 8.2 è‡ªå‹•ã‚³ã‚¹ãƒˆåˆ¶å¾¡

```typescript
class CostController {
  private monthlyBudget = 5.0; // $5åˆ¶é™

  async checkBudgetBeforeExecution(): Promise<boolean> {
    const currentCost = await this.getCurrentMonthlyCost();
    return currentCost < this.monthlyBudget * 0.9; // 90%ã§åˆ¶é™
  }

  async suspendExpensiveFeatures(): Promise<void> {
    // AIè©•ä¾¡ã‚’ä¸€æ™‚åœæ­¢
    await this.updateConfig({ ai: { enabled: false } });
    
    // é€šçŸ¥é€ä¿¡
    await this.notifyBudgetExceeded();
  }
}
```

**ã“ã‚Œã§æœˆ$5ä»¥ä¸‹ã§ã®é‹ç”¨ãŒå¯èƒ½ãªè¨­è¨ˆã«ãªã‚Šã¾ã—ãŸï¼**
</file>

<file path="docs/05_implementation_plan.md">
# å®Ÿè£…è¨ˆç”»æ›¸

## 1. é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 0: CI/CDç’°å¢ƒæ§‹ç¯‰ï¼ˆ1é€±é–“ï¼‰

**ç›®æ¨™**: å®‰å®šã—ãŸé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã®æ§‹ç¯‰

**æˆæœç‰©**
- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š
- TypeScript ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- ãƒ†ã‚¹ãƒˆç’°å¢ƒè¨­å®šï¼ˆJest + å‹å®šç¾©ï¼‰
- Lintingãƒ»ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®š
- AWS CDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
- ç’°å¢ƒåˆ¥è¨­å®šç®¡ç†

**ä¸»è¦ã‚¿ã‚¹ã‚¯**
```typescript
interface Phase0Tasks {
  projectSetup: {
    packageJson: 'TypeScript strict mode, ESLint, Prettier';
    tsconfigJson: 'å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯è¨­å®š';
    jestConfig: 'å˜ä½“ãƒ†ã‚¹ãƒˆç’°å¢ƒ';
    eslintConfig: 'anyå‹ç¦æ­¢ãƒ«ãƒ¼ãƒ«';
  };
  
  cicdPipeline: {
    workflow: '.github/workflows/ci.yml';
    testStage: 'lint, type-check, unit-test';
    buildStage: 'TypeScript compile, CDK synth';
    deployStages: 'staging, production (manual approval)';
  };
  
  awsInfrastructure: {
    cdkInit: 'TypeScript CDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ';
    stackStructure: 'ç’°å¢ƒåˆ¥ã‚¹ã‚¿ãƒƒã‚¯åˆ†é›¢';
    secretsManagement: 'GitHub Secrets è¨­è¨ˆ';
  };
}
```

**å®Œäº†åŸºæº–**
- [ ] TypeScript strict mode ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸ
- [ ] ESLint ã§ any å‹ä½¿ç”¨ã‚’ã‚¨ãƒ©ãƒ¼æ¤œå‡º
- [ ] Jest ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œå¯èƒ½
- [ ] GitHub Actions ã§CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‹•ä½œ
- [ ] CDK synth ãŒæˆåŠŸ
- [ ] ç’°å¢ƒåˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½

### Phase 1: AWSåŸºç›¤æ§‹ç¯‰ãƒ»ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆ1-2é€±é–“ï¼‰

**ç›®æ¨™**: AWS ã‚µãƒ¼ãƒãƒ¬ã‚¹åŸºç›¤ã®æ§‹ç¯‰ã¨ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®æ•´å‚™

**æˆæœç‰©**
- AWS CDK ã«ã‚ˆã‚‹ Infrastructure as Code
- S3ãƒã‚±ãƒƒãƒˆè¨­å®šã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼
- Lambdaé–¢æ•°ã®åŸºæœ¬æ§‹é€ 
- EventBridge ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
- Parameter Store ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒ

**ä¸»è¦ã‚¿ã‚¹ã‚¯**
```typescript
// CDK Stack æ§‹æˆ
interface CrowdWorksSearcherStackProps {
  s3Bucket: 'crowdworks-searcher-bucket';
  lambdaFunction: 'crowdworks-searcher-main';
  eventBridgeRule: '15åˆ†é–“éš”å®Ÿè¡Œ';
  parameterStore: 'ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†';
  iamRoles: 'æœ€å°æ¨©é™è¨­å®š';
}
```

**å®Œäº†åŸºæº–**
- [ ] CDK deploy ãŒæˆåŠŸ
- [ ] S3ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ãŒè¨­å®šæ¸ˆã¿
- [ ] Lambdaé–¢æ•°ãŒ EventBridge ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½
- [ ] Parameter Store ã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ãŒæ©Ÿèƒ½
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®é–‹ç™ºç’°å¢ƒãŒæ§‹ç¯‰æ¸ˆã¿
- [ ] ã‚³ã‚¹ãƒˆç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¨­å®šæ¸ˆã¿

### Phase 2: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ©Ÿèƒ½å®Ÿè£…ï¼ˆ2-3é€±é–“ï¼‰

**ç›®æ¨™**: ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã‹ã‚‰ã®æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å–å¾—æ©Ÿèƒ½

**æˆæœç‰©**
- Playwright ã«ã‚ˆã‚‹ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–
- èªè¨¼ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ»æ­£è¦åŒ–æ©Ÿèƒ½
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- S3ã¸ã®æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½

**ä¸»è¦ã‚¿ã‚¹ã‚¯**
```typescript
// ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
class CrowdWorksScrapingService {
  async initialize(): Promise<void>;
  async authenticate(credentials: LoginCredentials): Promise<void>;
  async searchJobs(conditions: SearchCondition[]): Promise<JobData[]>;
  async extractJobData(element: ElementHandle): Promise<JobData>;
  async cleanup(): Promise<void>;
}

// ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
class S3DataService {
  async saveJobs(jobs: JobData[], timestamp: string): Promise<void>;
  async getRecentJobs(hours: number): Promise<JobData[]>;
  async getExistingJobIds(hours: number): Promise<Set<string>>;
}
```

**å®Œäº†åŸºæº–**
- [ ] ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã¸ã®è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ãŒæˆåŠŸ
- [ ] æ¤œç´¢æ¡ä»¶ã«åŸºã¥ãæ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå‹•ä½œ
- [ ] å–å¾—ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãS3ã«ä¿å­˜ã•ã‚Œã‚‹
- [ ] é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªãƒªãƒˆãƒ©ã‚¤å‡¦ç†
- [ ] Lambdaå®Ÿè¡Œæ™‚é–“ãŒ10åˆ†ä»¥å†…

### Phase 3: AIè©•ä¾¡æ©Ÿèƒ½å®Ÿè£…ï¼ˆ2é€±é–“ï¼‰

**ç›®æ¨™**: ChatGPT API ã«ã‚ˆã‚‹æ¡ˆä»¶è©•ä¾¡ã¨ã‚³ã‚¹ãƒˆåˆ¶å¾¡

**æˆæœç‰©**
- ChatGPT API é€£æºæ©Ÿèƒ½
- è©•ä¾¡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ»ã‚³ã‚¹ãƒˆåˆ¶é™æ©Ÿèƒ½
- è©•ä¾¡çµæœã® S3 ä¿å­˜æ©Ÿèƒ½
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè©•ä¾¡ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

**ä¸»è¦ã‚¿ã‚¹ã‚¯**
```typescript
// AIè©•ä¾¡ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
class ChatGPTAPIService {
  private rateLimiter: RateLimiter;
  private costTracker: CostTracker;
  
  async evaluateJob(job: JobData): Promise<JobEvaluation>;
  async evaluateJobsBatch(jobs: JobData[]): Promise<JobEvaluation[]>;
  private createEvaluationPrompt(job: JobData): string;
  private parseEvaluationResponse(content: string): JobEvaluation;
}

// ã‚³ã‚¹ãƒˆåˆ¶å¾¡å®Ÿè£…
class CostTracker {
  private monthlyUsage: number = 0;
  private readonly monthlyLimit: number = 3.0; // $3åˆ¶é™
  
  addUsage(cost: number): void;
  isOverLimit(): boolean;
  getRemainingBudget(): number;
}
```

**å®Œäº†åŸºæº–**
- [ ] ChatGPT API é€£æºãŒæ­£å¸¸å‹•ä½œ
- [ ] æœˆ$3ã®ã‚³ã‚¹ãƒˆåˆ¶é™ãŒæ©Ÿèƒ½
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œãŒå®Ÿè£…æ¸ˆã¿
- [ ] è©•ä¾¡çµæœãŒS3ã«æ­£ã—ãä¿å­˜
- [ ] APIéšœå®³æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œç¢ºèª
- [ ] è©•ä¾¡ç²¾åº¦ã®åˆæœŸæ¤œè¨¼å®Œäº†

### Phase 4: é€šçŸ¥ãƒ»ç›£è¦–æ©Ÿèƒ½å®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰

**ç›®æ¨™**: ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã¨é«˜è©•ä¾¡æ¡ˆä»¶é€šçŸ¥ã®å®Ÿè£…

**æˆæœç‰©**
- SNS/SES ã«ã‚ˆã‚‹é€šçŸ¥æ©Ÿèƒ½
- ã‚¨ãƒ©ãƒ¼ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½
- é«˜è©•ä¾¡æ¡ˆä»¶ã®å³åº§é€šçŸ¥
- æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç›£è¦–API

**ä¸»è¦ã‚¿ã‚¹ã‚¯**
```typescript
// é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
class NotificationService {
  async sendErrorAlert(error: Error, executionId: string): Promise<void>;
  async sendHighScoreAlert(jobs: JobEvaluation[]): Promise<void>;
  async sendDailySummary(summary: DailySummary): Promise<void>;
}

// ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
class MonitoringService {
  async checkSystemHealth(): Promise<SystemStatus>;
  async calculateMonthlyStats(): Promise<MonthlyStats>;
  async generateDailySummary(): Promise<DailySummary>;
}
```

**å®Œäº†åŸºæº–**
- [ ] ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®SNSé€šçŸ¥ãŒå‹•ä½œ
- [ ] é«˜è©•ä¾¡æ¡ˆä»¶ã®å³åº§é€šçŸ¥ãŒæ©Ÿèƒ½
- [ ] æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒå‹•ä½œ
- [ ] ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç›£è¦–APIãŒåˆ©ç”¨å¯èƒ½
- [ ] é€šçŸ¥å†…å®¹ã®é©åˆ‡æ€§ç¢ºèª

### Phase 5: é‹ç”¨ãƒ»æ”¹å–„ãƒ»æœ€é©åŒ–ï¼ˆç¶™ç¶šçš„ï¼‰

**ç›®æ¨™**: å®‰å®šé‹ç”¨ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã€æ©Ÿèƒ½æ”¹å–„

**æˆæœç‰©**
- é‹ç”¨æ‰‹é †æ›¸ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ã‚³ã‚¹ãƒˆç›£è¦–ãƒ»æœ€é©åŒ–
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
- æ©Ÿèƒ½æ‹¡å¼µå¯¾å¿œ

**ä¸»è¦ã‚¿ã‚¹ã‚¯**
- ã‚³ã‚¹ãƒˆåˆ†æã¨ã•ã‚‰ãªã‚‹æœ€é©åŒ–
- å®Ÿè¡Œæ™‚é–“çŸ­ç¸®ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- ã‚¨ãƒ©ãƒ¼ç‡å‰Šæ¸›ã¨å®‰å®šæ€§å‘ä¸Š
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã¨æ”¹å–„
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

**å®Œäº†åŸºæº–**
- [ ] æœˆ$5ä»¥ä¸‹ã®ã‚³ã‚¹ãƒˆç›®æ¨™é”æˆ
- [ ] ç¨¼åƒç‡95%ä»¥ä¸Šã®å®‰å®šé‹ç”¨
- [ ] å¹³å‡å®Ÿè¡Œæ™‚é–“1åˆ†ä»¥å†…
- [ ] ã‚¨ãƒ©ãƒ¼ç‡5%ä»¥ä¸‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨

## 2. ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

### 2.1 çŸ­æœŸç›®æ¨™ï¼ˆ1-2é€±é–“ï¼‰

**Week 1: AWSåŸºç›¤æ§‹ç¯‰**
- Day 1-2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ã€CDK ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- Day 3-4: S3ãƒã‚±ãƒƒãƒˆã€Lambdaã€EventBridge æ§‹ç¯‰
- Day 5-7: Parameter Storeã€IAMè¨­å®šã€åˆæœŸãƒ†ã‚¹ãƒˆ

**Week 2: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°åŸºç›¤**
- Day 8-10: Playwright ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€Lambda Layerä½œæˆ
- Day 11-12: èªè¨¼æ©Ÿèƒ½å®Ÿè£…ã€åŸºæœ¬ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- Day 13-14: ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ»æ­£è¦åŒ–ã€S3ä¿å­˜æ©Ÿèƒ½

**æˆæœç‰©ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**
```typescript
interface Week2Deliverables {
  infrastructure: {
    cdkDeployment: 'âœ… æˆåŠŸ';
    s3Bucket: 'âœ… ä½œæˆãƒ»è¨­å®šå®Œäº†';
    lambdaFunction: 'âœ… åŸºæœ¬å®Ÿè£…';
    eventBridge: 'âœ… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š';
  };
  
  scraping: {
    authentication: 'âœ… ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½';
    dataExtraction: 'âœ… åŸºæœ¬æŠ½å‡º';
    s3Integration: 'âœ… ãƒ‡ãƒ¼ã‚¿ä¿å­˜';
    errorHandling: 'âœ… åŸºæœ¬ã‚¨ãƒ©ãƒ¼å‡¦ç†';
  };
}
```

### 2.2 ä¸­æœŸç›®æ¨™ï¼ˆ1ãƒ¶æœˆï¼‰

**Week 3-4: AIæ©Ÿèƒ½ãƒ»é€šçŸ¥æ©Ÿèƒ½å®Œæˆ**
- Week 3: ChatGPT APIé€£æºã€è©•ä¾¡æ©Ÿèƒ½å®Ÿè£…
- Week 4: é€šçŸ¥æ©Ÿèƒ½ã€ç›£è¦–æ©Ÿèƒ½å®Ÿè£…

**Month 1 å®Œäº†ç›®æ¨™**
- å…¨æ©Ÿèƒ½ã®åŸºæœ¬å®Ÿè£…å®Œäº†
- 15åˆ†é–“éš”ã§ã®è‡ªå‹•å®Ÿè¡ŒãŒå®‰å®šå‹•ä½œ
- ã‚³ã‚¹ãƒˆ$5ä»¥ä¸‹ã§ã®é‹ç”¨ç¢ºèª
- åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæ©Ÿèƒ½

**å“è³ªåŸºæº–**
```typescript
interface Month1QualityGates {
  functionality: {
    scraping: '90%ä»¥ä¸Šã®æˆåŠŸç‡';
    aiEvaluation: '80%ä»¥ä¸Šã®æˆåŠŸç‡';
    notification: '95%ä»¥ä¸Šã®é€ä¿¡æˆåŠŸç‡';
  };
  
  performance: {
    executionTime: 'å¹³å‡2åˆ†ä»¥å†…';
    errorRate: '10%ä»¥ä¸‹';
    costPerMonth: '$5ä»¥ä¸‹';
  };
  
  reliability: {
    uptime: '90%ä»¥ä¸Š';
    dataIntegrity: '99%ä»¥ä¸Š';
  };
}
```

### 2.3 é•·æœŸç›®æ¨™ï¼ˆ3ãƒ¶æœˆï¼‰

**Month 2: å®‰å®šåŒ–ãƒ»æœ€é©åŒ–**
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆå®Ÿè¡Œæ™‚é–“1åˆ†ä»¥å†…ï¼‰
- ã‚¨ãƒ©ãƒ¼ç‡5%ä»¥ä¸‹é”æˆ
- ã‚³ã‚¹ãƒˆ$4ä»¥ä¸‹ã¸ã®å‰Šæ¸›
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

**Month 3: é‹ç”¨æ”¹å–„ãƒ»æ©Ÿèƒ½æ‹¡å¼µ**
- é«˜åº¦ãªç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½
- è©•ä¾¡ç²¾åº¦å‘ä¸Š
- ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½å¼·åŒ–
- å°†æ¥æ‹¡å¼µã®æº–å‚™

**3ãƒ¶æœˆå¾Œã®ç›®æ¨™çŠ¶æ…‹**
```typescript
interface ThreeMonthTarget {
  operational: {
    uptime: '95%ä»¥ä¸Š';
    avgExecutionTime: '60ç§’ä»¥å†…';
    errorRate: '5%ä»¥ä¸‹';
    monthlyCost: '$4ä»¥ä¸‹';
  };
  
  quality: {
    dataAccuracy: '95%ä»¥ä¸Š';
    aiEvaluationPrecision: '85%ä»¥ä¸Š';
    notificationReliability: '99%ä»¥ä¸Š';
  };
  
  business: {
    jobDiscoveryRate: 'é«˜è©•ä¾¡æ¡ˆä»¶ã‚’80%ã‚­ãƒ£ãƒƒãƒ';
    falsePositiveRate: '20%ä»¥ä¸‹';
    userSatisfaction: 'é‹ç”¨è² è·ã»ã¼ã‚¼ãƒ­';
  };
}
```

## 3. ã‚¿ã‚¹ã‚¯åˆ†è§£

### 3.1 ç’°å¢ƒæ§‹ç¯‰ã‚¿ã‚¹ã‚¯

**AWS CDK ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
```typescript
// CDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
interface CDKSetupTasks {
  initialization: [
    'npm install -g aws-cdk',
    'cdk init app --language typescript',
    'npm install @aws-cdk/aws-*ã®å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸',
    'cdk bootstrapï¼ˆåˆå›ã®ã¿ï¼‰'
  ];
  
  stackImplementation: [
    'S3BucketStackå®Ÿè£…',
    'LambdaStackå®Ÿè£…', 
    'EventBridgeStackå®Ÿè£…',
    'IAMRoleStackå®Ÿè£…',
    'ParameterStoreStackå®Ÿè£…'
  ];
  
  validation: [
    'cdk synth ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºèª',
    'cdk deploy --dry-run',
    'cdk deploy ã§å®Ÿç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤',
    'AWS Console ã§è¨­å®šç¢ºèª'
  ];
}
```

**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ**
```typescript
interface LocalDevEnvironment {
  tools: [
    'Node.js 18.x',
    'TypeScript 5.x',
    'AWS CLI v2',
    'AWS CDK CLI',
    'Dockerï¼ˆPlaywrightç”¨ï¼‰'
  ];
  
  configuration: [
    'AWSèªè¨¼æƒ…å ±è¨­å®š',
    'VS Codeæ‹¡å¼µæ©Ÿèƒ½ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«',
    'ESLint/Prettierè¨­å®š',
    'Jest ãƒ†ã‚¹ãƒˆç’°å¢ƒ',
    'TypeScript strictè¨­å®š'
  ];
  
  validation: [
    'aws sts get-caller-identity',
    'cdk --version',
    'npm test',
    'TypeScriptå‹ãƒã‚§ãƒƒã‚¯'
  ];
}
```

### 3.2 é–‹ç™ºã‚¿ã‚¹ã‚¯

**Phase 1 é–‹ç™ºã‚¿ã‚¹ã‚¯ï¼ˆAWSåŸºç›¤ï¼‰**
```typescript
interface Phase1DevelopmentTasks {
  infrastructure: {
    priority: 'High';
    tasks: [
      {
        name: 'S3ãƒã‚±ãƒƒãƒˆä½œæˆ';
        description: 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨S3ãƒã‚±ãƒƒãƒˆã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼è¨­å®š';
        estimatedHours: 4;
        dependencies: [];
      },
      {
        name: 'Lambdaé–¢æ•°åŸºç›¤';
        description: 'ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œç”¨Lambdaé–¢æ•°ã€Layerè¨­å®š';
        estimatedHours: 8;
        dependencies: ['S3ãƒã‚±ãƒƒãƒˆä½œæˆ'];
      },
      {
        name: 'EventBridgeè¨­å®š';
        description: '15åˆ†é–“éš”ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š';
        estimatedHours: 2;
        dependencies: ['Lambdaé–¢æ•°åŸºç›¤'];
      },
      {
        name: 'Parameter Store';
        description: 'ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã€æš—å·åŒ–è¨­å®š';
        estimatedHours: 4;
        dependencies: [];
      }
    ];
  };
}
```

**Phase 2 é–‹ç™ºã‚¿ã‚¹ã‚¯ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰**
```typescript
interface Phase2DevelopmentTasks {
  scraping: {
    priority: 'High';
    tasks: [
      {
        name: 'Playwright Lambda Layer';
        description: 'ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒŠãƒªå«ã‚€Layerä½œæˆ';
        estimatedHours: 12;
        technicalRisk: 'High - Lambdaå®¹é‡åˆ¶é™';
      },
      {
        name: 'èªè¨¼æ©Ÿèƒ½';
        description: 'ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ­ã‚°ã‚¤ãƒ³è‡ªå‹•åŒ–';
        estimatedHours: 8;
        technicalRisk: 'Medium - ã‚µã‚¤ãƒˆä»•æ§˜å¤‰æ›´ãƒªã‚¹ã‚¯';
      },
      {
        name: 'ãƒ‡ãƒ¼ã‚¿æŠ½å‡º';
        description: 'æ¡ˆä»¶æƒ…å ±ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ»æ­£è¦åŒ–';
        estimatedHours: 16;
        technicalRisk: 'High - HTMLæ§‹é€ ä¾å­˜';
      },
      {
        name: 'é‡è¤‡ãƒã‚§ãƒƒã‚¯';
        description: 'æ—¢å­˜æ¡ˆä»¶ã¨ã®é‡è¤‡æ’é™¤æ©Ÿèƒ½';
        estimatedHours: 6;
        technicalRisk: 'Low';
      }
    ];
  };
}
```

**Phase 3 é–‹ç™ºã‚¿ã‚¹ã‚¯ï¼ˆAIè©•ä¾¡ï¼‰**
```typescript
interface Phase3DevelopmentTasks {
  aiEvaluation: {
    priority: 'Medium';
    tasks: [
      {
        name: 'ChatGPT APIé€£æº';
        description: 'OpenAI SDKçµ±åˆã€APIå‘¼ã³å‡ºã—';
        estimatedHours: 8;
        technicalRisk: 'Medium - APIå¤‰æ›´ãƒªã‚¹ã‚¯';
      },
      {
        name: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–';
        description: 'è©•ä¾¡ç²¾åº¦å‘ä¸Šã®ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆèª¿æ•´';
        estimatedHours: 12;
        technicalRisk: 'Medium - è©•ä¾¡ç²¾åº¦ç¢ºä¿';
      },
      {
        name: 'ã‚³ã‚¹ãƒˆåˆ¶å¾¡';
        description: 'ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€æœˆé¡äºˆç®—åˆ¶é™å®Ÿè£…';
        estimatedHours: 6;
        technicalRisk: 'Low';
      },
      {
        name: 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯';
        description: 'APIéšœå®³æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè©•ä¾¡';
        estimatedHours: 4;
        technicalRisk: 'Low';
      }
    ];
  };
}
```

### 3.3 ãƒ†ã‚¹ãƒˆã‚¿ã‚¹ã‚¯

**å˜ä½“ãƒ†ã‚¹ãƒˆ**
```typescript
interface UnitTestStrategy {
  coverage: {
    target: '80%ä»¥ä¸Š';
    priority: 'ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯100%ã€ã‚¤ãƒ³ãƒ•ãƒ©å±¤60%';
  };
  
  testSuites: [
    {
      name: 'S3DataService';
      tests: ['ãƒ‡ãƒ¼ã‚¿ä¿å­˜', 'ãƒ‡ãƒ¼ã‚¿å–å¾—', 'é‡è¤‡ãƒã‚§ãƒƒã‚¯'];
      mockStrategy: 'AWS SDK v3 mock';
    },
    {
      name: 'ChatGPTAPIService';
      tests: ['APIå‘¼ã³å‡ºã—', 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æ', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°'];
      mockStrategy: 'OpenAI API mock';
    },
    {
      name: 'CrowdWorksScrapingService';
      tests: ['èªè¨¼', 'ãƒ‡ãƒ¼ã‚¿æŠ½å‡º', 'ã‚¨ãƒ©ãƒ¼å‡¦ç†'];
      mockStrategy: 'Playwright Page mock';
    }
  ];
  
  tools: ['Jest', '@types/jest', 'aws-sdk-client-mock'];
}
```

**çµåˆãƒ†ã‚¹ãƒˆ**
```typescript
interface IntegrationTestStrategy {
  scope: 'AWS ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã€å¤–éƒ¨APIé€£æº';
  
  testSuites: [
    {
      name: 'Lambda-S3é€£æº';
      description: 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»å–å¾—ã®ä¸€é€£ã®æµã‚Œ';
      environment: 'ãƒ†ã‚¹ãƒˆç”¨AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ';
    },
    {
      name: 'EventBridge-Lambdaé€£æº';
      description: 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã®å‹•ä½œç¢ºèª';
      environment: 'ãƒ†ã‚¹ãƒˆç”¨AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ';
    },
    {
      name: 'ChatGPT APIé€£æº';
      description: 'å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†';
      environment: 'ãƒ†ã‚¹ãƒˆç”¨APIã‚­ãƒ¼';
    }
  ];
}
```

**E2Eãƒ†ã‚¹ãƒˆ**
```typescript
interface E2ETestStrategy {
  scope: 'ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å‹•ä½œç¢ºèª';
  
  scenarios: [
    {
      name: 'æ­£å¸¸ãƒ•ãƒ­ãƒ¼';
      steps: [
        'EventBridge ãƒˆãƒªã‚¬ãƒ¼',
        'ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè¡Œ',
        'AIè©•ä¾¡å®Ÿè¡Œ',
        'S3ãƒ‡ãƒ¼ã‚¿ä¿å­˜',
        'é€šçŸ¥é€ä¿¡'
      ];
      expectedResult: 'å…¨ã¦æˆåŠŸã€é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜';
    },
    {
      name: 'ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ•ãƒ­ãƒ¼';
      steps: [
        'ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¤±æ•—',
        'ãƒªãƒˆãƒ©ã‚¤å®Ÿè¡Œ',
        'ã‚¨ãƒ©ãƒ¼é€šçŸ¥é€ä¿¡'
      ];
      expectedResult: 'ã‚¨ãƒ©ãƒ¼é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹';
    }
  ];
}
```

### 3.4 ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¿ã‚¹ã‚¯

**ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥**
```typescript
interface DeploymentStrategy {
  environments: {
    development: {
      description: 'ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆ';
      deployment: 'npm run dev';
      dataSource: 'ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿';
    };
    
    staging: {
      description: 'çµåˆãƒ†ã‚¹ãƒˆãƒ»E2Eãƒ†ã‚¹ãƒˆ';
      deployment: 'cdk deploy --profile staging';
      dataSource: 'ãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ï¼ˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ï¼‰';
    };
    
    production: {
      description: 'æœ¬ç•ªé‹ç”¨';
      deployment: 'cdk deploy --profile production';
      dataSource: 'å®Ÿéš›ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹';
    };
  };
  
  process: [
    'ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ',
    'stagingç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤',
    'stagingç’°å¢ƒã§ã®çµåˆãƒ†ã‚¹ãƒˆ',
    'productionç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤',
    'productionç’°å¢ƒã§ã®å‹•ä½œç¢ºèª',
    'ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šç¢ºèª'
  ];
}
```

**ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–**
```typescript
interface DeploymentAutomation {
  cicd: {
    tool: 'GitHub Actionsï¼ˆç„¡æ–™æ ï¼‰';
    triggers: ['main branch push', 'release tag'];
  };
  
  pipeline: [
    {
      stage: 'Test';
      actions: ['npm test', 'lint check', 'type check'];
    },
    {
      stage: 'Build';
      actions: ['npm run build', 'cdk synth'];
    },
    {
      stage: 'Deploy to Staging';
      actions: ['cdk deploy staging'];
      condition: 'branch == main';
    },
    {
      stage: 'E2E Test';
      actions: ['run e2e tests on staging'];
    },
    {
      stage: 'Deploy to Production';
      actions: ['cdk deploy production'];
      condition: 'tag release';
      approval: 'manual';
    }
  ];
}
```

## 4. ãƒªã‚¹ã‚¯ç®¡ç†

### 4.1 æŠ€è¡“çš„ãƒªã‚¹ã‚¯

**é«˜ãƒªã‚¹ã‚¯é …ç›®**
```typescript
interface HighTechnicalRisks {
  playwrightLambda: {
    risk: 'Playwright on Lambda ã®å®¹é‡ãƒ»å®Ÿè¡Œæ™‚é–“åˆ¶é™';
    probability: 'High';
    impact: 'High';
    mitigation: [
      'Lambda Layeræœ€é©åŒ–ï¼ˆä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ï¼‰',
      'ãƒ–ãƒ©ã‚¦ã‚¶ã‚ªãƒ—ã‚·ãƒ§ãƒ³èª¿æ•´ï¼ˆè»½é‡åŒ–ï¼‰',
      'ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã®å……å®Ÿ',
      'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…'
    ];
    contingency: 'Fargate ã¸ã®ç§»è¡Œæ¤œè¨';
  };
  
  crowdworksChanges: {
    risk: 'ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã‚µã‚¤ãƒˆä»•æ§˜å¤‰æ›´';
    probability: 'Medium';
    impact: 'High';
    mitigation: [
      'ã‚»ãƒ¬ã‚¯ã‚¿ã®æŸ”è»ŸãªæŒ‡å®š',
      'è¤‡æ•°ã®æŠ½å‡ºæ–¹æ³•ç”¨æ„',
      'å®šæœŸçš„ãªå‹•ä½œç¢ºèª',
      'ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½'
    ];
    contingency: 'æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ‰‹é †ã®æº–å‚™';
  };
  
  chatgptApiChanges: {
    risk: 'ChatGPT APIä»•æ§˜å¤‰æ›´ãƒ»ä¾¡æ ¼å¤‰æ›´';
    probability: 'Medium';
    impact: 'Medium';
    mitigation: [
      'API ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š',
      'ã‚³ã‚¹ãƒˆç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆ',
      'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯',
      'ä»–LLM APIã®èª¿æŸ»'
    ];
    contingency: 'ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹è©•ä¾¡ã¸ã®åˆ‡ã‚Šæ›¿ãˆ';
  };
}
```

**ä¸­ãƒªã‚¹ã‚¯é …ç›®**
```typescript
interface MediumTechnicalRisks {
  awsCostOverrun: {
    risk: 'AWSåˆ©ç”¨æ–™é‡‘ã®äºˆæƒ³å¤–ã®å¢—åŠ ';
    probability: 'Medium';
    impact: 'Medium';
    mitigation: [
      'AWS Cost Explorer ã§ã®ç›£è¦–',
      'Billing Alerts è¨­å®š',
      'ãƒªã‚½ãƒ¼ã‚¹åˆ©ç”¨é‡ã®å®šæœŸç¢ºèª',
      'ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ç¶™ç¶šçš„å®Ÿæ–½'
    ];
  };
  
  performanceDegradation: {
    risk: 'Lambdaå®Ÿè¡Œæ™‚é–“ã®å¢—åŠ ';
    probability: 'Medium';
    impact: 'Medium';
    mitigation: [
      'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–',
      'ã‚³ãƒ¼ãƒ‰æœ€é©åŒ–',
      'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°å®Ÿæ–½',
      'ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¦‹ç›´ã—'
    ];
  };
}
```

### 4.2 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒªã‚¹ã‚¯

**é–‹ç™ºé…å»¶ãƒªã‚¹ã‚¯**
```typescript
interface ScheduleRisks {
  playwrightIntegration: {
    plannedDuration: '1é€±é–“';
    riskFactor: 'æŠ€è¡“çš„å›°é›£ã«ã‚ˆã‚Š2-3é€±é–“ã«å»¶é•·ã®å¯èƒ½æ€§';
    mitigation: [
      'äº‹å‰èª¿æŸ»ãƒ»ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ä½œæˆ',
      'ä»£æ›¿æ¡ˆï¼ˆPuppeteerç­‰ï¼‰ã®æº–å‚™',
      'ãƒãƒƒãƒ•ã‚¡æœŸé–“ã®ç¢ºä¿'
    ];
  };
  
  aiPromptOptimization: {
    plannedDuration: '1é€±é–“';
    riskFactor: 'è©•ä¾¡ç²¾åº¦ç¢ºä¿ã§åå¾©ãŒå¿…è¦';
    mitigation: [
      'è©•ä¾¡åŸºæº–ã®æ˜ç¢ºåŒ–',
      'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæº–å‚™',
      'æ®µéšçš„æ”¹å–„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ'
    ];
  };
  
  awsLearningCurve: {
    plannedDuration: 'ç¶™ç¶šçš„';
    riskFactor: 'CDKãƒ»ã‚µãƒ¼ãƒãƒ¬ã‚¹æŠ€è¡“ã®ç¿’å¾—æ™‚é–“';
    mitigation: [
      'äº‹å‰å­¦ç¿’æœŸé–“ã®ç¢ºä¿',
      'AWSãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«æ´»ç”¨',
      'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‹ã‚‰ã®æƒ…å ±åé›†'
    ];
  };
}
```

### 4.3 å¯¾ç­–ãƒ»å›é¿ç­–

**ãƒªã‚¹ã‚¯è»½æ¸›æˆ¦ç•¥**
```typescript
interface RiskMitigationStrategy {
  proactiveApproach: {
    prototypeFirst: 'æœ¬æ ¼å®Ÿè£…å‰ã®PoCå®Ÿæ–½';
    incrementalDevelopment: 'æ©Ÿèƒ½ã‚’æ®µéšçš„ã«å®Ÿè£…ãƒ»æ¤œè¨¼';
    continuousMonitoring: 'ç¶™ç¶šçš„ãªç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ';
    documentationFirst: 'è¨­è¨ˆæ›¸ã®äº‹å‰ä½œæˆ';
  };
  
  contingencyPlans: {
    technicalAlternatives: {
      playwright: 'Puppeteerã€Selenium';
      chatgpt: 'Claudeã€Geminiã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹';
      lambda: 'Fargateã€EC2';
    };
    
    fallbackMechanisms: {
      scrapingFailure: 'ã‚¨ãƒ©ãƒ¼é€šçŸ¥ + æ‰‹å‹•å®Ÿè¡Œæ‰‹é †';
      aiFailure: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ã‚¢ + åŸºæœ¬ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°';
      notificationFailure: 'ãƒ­ã‚°å‡ºåŠ› + CloudWatchç›£è¦–';
    };
  };
  
  qualityAssurance: {
    codeReview: 'å…¨PRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆ';
    testing: 'å„æ©Ÿèƒ½80%ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸';
    monitoring: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ';
    backup: 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†';
  };
}
```

## 5. å“è³ªç®¡ç†

### 5.1 ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ–¹é‡

**ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸºæº–**
```typescript
interface CodeReviewStandards {
  mandatory: {
    typeDefinitions: 'å…¨é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã®å‹å®šç¾©å¿…é ˆ';
    errorHandling: 'é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°';
    testing: 'æ–°æ©Ÿèƒ½ã®å˜ä½“ãƒ†ã‚¹ãƒˆå¿…é ˆ';
    documentation: 'TSDocã‚³ãƒ¡ãƒ³ãƒˆ';
    security: 'ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç¦æ­¢';
  };
  
  performance: {
    lambdaOptimization: 'ãƒ¡ãƒ¢ãƒªãƒ»å®Ÿè¡Œæ™‚é–“ã®æœ€é©åŒ–';
    s3Operations: 'æœ€å°é™ã®APIå‘¼ã³å‡ºã—';
    costConsciousness: 'ã‚³ã‚¹ãƒˆã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®è€ƒæ…®';
  };
  
  maintainability: {
    codeStructure: 'é©åˆ‡ãªé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹åˆ†å‰²';
    naming: 'æ„å‘³çš„ãªå¤‰æ•°ãƒ»é–¢æ•°å';
    constants: 'ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã®æ’é™¤';
    comments: 'è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®èª¬æ˜';
  };
}
```

**ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**
```typescript
interface ReviewProcess {
  steps: [
    'é–‹ç™ºè€…ã«ã‚ˆã‚‹è‡ªå·±ãƒ¬ãƒ“ãƒ¥ãƒ¼',
    'ESLintãƒ»Prettier ã«ã‚ˆã‚‹è‡ªå‹•ãƒã‚§ãƒƒã‚¯',
    'TypeScriptå‹ãƒã‚§ãƒƒã‚¯',
    'å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ',
    'Pull Request ä½œæˆ',
    'ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½',
    'ä¿®æ­£ãƒ»å†ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰',
    'ãƒãƒ¼ã‚¸ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤'
  ];
  
  criteria: {
    functionalCorrectness: 'æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã®ç¢ºèª';
    codeQuality: 'Clean Code åŸå‰‡ã®éµå®ˆ';
    testCoverage: '80%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸';
    documentation: 'å¿…è¦ãªèª¬æ˜ã®è¿½åŠ ';
    security: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹';
  };
}
```

### 5.2 ãƒ†ã‚¹ãƒˆæ–¹é‡

**ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**
```typescript
interface TestStrategy {
  pyramid: {
    unit: {
      coverage: '80%ä»¥ä¸Š';
      focus: 'ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°';
      tools: ['Jest', '@types/jest'];
      mocking: 'AWS SDKã€å¤–éƒ¨API';
    };
    
    integration: {
      coverage: 'ä¸»è¦ãƒ•ãƒ­ãƒ¼100%';
      focus: 'AWS ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æº';
      environment: 'ãƒ†ã‚¹ãƒˆç”¨AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ';
      tools: ['Jest', 'aws-sdk-client-mock'];
    };
    
    e2e: {
      coverage: 'é‡è¦ã‚·ãƒŠãƒªã‚ª100%';
      focus: 'ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª';
      environment: 'stagingç’°å¢ƒ';
      tools: ['Jest', 'å®Ÿéš›ã®AWSç’°å¢ƒ'];
    };
  };
  
  testTypes: {
    functional: 'æ©Ÿèƒ½è¦ä»¶ã®ç¢ºèª';
    performance: 'å®Ÿè¡Œæ™‚é–“ãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡';
    reliability: 'ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ»å›å¾©æ©Ÿèƒ½';
    security: 'èªè¨¼ãƒ»èªå¯ãƒ»ãƒ‡ãƒ¼ã‚¿ä¿è­·';
    cost: 'AWSåˆ©ç”¨æ–™é‡‘ã®æƒ³å®šå†…ç¢ºèª';
  };
}
```

**ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–**
```typescript
interface TestAutomation {
  continuous: {
    trigger: ['ã‚³ãƒŸãƒƒãƒˆæ™‚', 'PRä½œæˆæ™‚', 'ãƒãƒ¼ã‚¸æ™‚'];
    pipeline: [
      'Lint ãƒã‚§ãƒƒã‚¯',
      'å‹ãƒã‚§ãƒƒã‚¯',
      'å˜ä½“ãƒ†ã‚¹ãƒˆ',
      'ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª',
      'çµåˆãƒ†ã‚¹ãƒˆï¼ˆstagingï¼‰'
    ];
  };
  
  scheduled: {
    e2eTests: 'æ—¥æ¬¡å®Ÿè¡Œï¼ˆæœ¬ç•ªç’°å¢ƒç›£è¦–ï¼‰';
    performanceTests: 'é€±æ¬¡å®Ÿè¡Œ';
    securityTests: 'æœˆæ¬¡å®Ÿè¡Œ';
  };
  
  reporting: {
    coverage: 'Codecov é€£æº';
    results: 'GitHub Actions ãƒ­ã‚°';
    alerts: 'Slack é€šçŸ¥ï¼ˆå¤±æ•—æ™‚ï¼‰';
  };
}
```

### 5.3 å“è³ªæŒ‡æ¨™

**å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**
```typescript
interface QualityMetrics {
  functional: {
    successRate: {
      target: '95%ä»¥ä¸Š';
      measurement: '15åˆ†é–“éš”å®Ÿè¡Œã®æˆåŠŸç‡';
    };
    
    dataAccuracy: {
      target: '95%ä»¥ä¸Š';
      measurement: 'å–å¾—ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§';
    };
    
    evaluationPrecision: {
      target: '80%ä»¥ä¸Š';
      measurement: 'AIè©•ä¾¡ã¨æ‰‹å‹•è©•ä¾¡ã®ä¸€è‡´ç‡';
    };
  };
  
  performance: {
    executionTime: {
      target: 'å¹³å‡60ç§’ä»¥å†…';
      measurement: 'Lambdaå®Ÿè¡Œæ™‚é–“';
    };
    
    errorRate: {
      target: '5%ä»¥ä¸‹';
      measurement: 'å®Ÿè¡Œå¤±æ•—ç‡';
    };
    
    responseTime: {
      target: 'APIå‘¼ã³å‡ºã—3ç§’ä»¥å†…';
      measurement: 'ChatGPT APIå¿œç­”æ™‚é–“';
    };
  };
  
  reliability: {
    uptime: {
      target: '95%ä»¥ä¸Š';
      measurement: 'ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡';
    };
    
    recovery: {
      target: '15åˆ†ä»¥å†…';
      measurement: 'ã‚¨ãƒ©ãƒ¼ã‹ã‚‰ã®è‡ªå‹•å›å¾©æ™‚é–“';
    };
  };
  
  cost: {
    monthlyBudget: {
      target: '$5ä»¥ä¸‹';
      measurement: 'AWSåˆ©ç”¨æ–™é‡‘åˆè¨ˆ';
    };
    
    costPerExecution: {
      target: '$0.05ä»¥ä¸‹';
      measurement: '1å›å®Ÿè¡Œã‚ãŸã‚Šã®ã‚³ã‚¹ãƒˆ';
    };
  };
}
```

**å“è³ªæ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹**
```typescript
interface QualityImprovementProcess {
  monitoring: {
    realtime: 'CloudWatch ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–';
    daily: 'æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª';
    weekly: 'é€±æ¬¡å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼';
    monthly: 'æœˆæ¬¡ã‚³ã‚¹ãƒˆãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ';
  };
  
  improvement: {
    threshold: 'ç›®æ¨™å€¤ã‚’ä¸‹å›ã£ãŸå ´åˆã®æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³';
    analysis: 'åŸå› åˆ†æãƒ»æ ¹æœ¬å¯¾ç­–ã®å®Ÿæ–½';
    optimization: 'ç¶™ç¶šçš„ãªæœ€é©åŒ–';
    documentation: 'æ”¹å–„å†…å®¹ã®è¨˜éŒ²ãƒ»å…±æœ‰';
  };
  
  feedback: {
    userFeedback: 'å®Ÿéš›ã®åˆ©ç”¨è€…ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†';
    metrics: 'ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæ”¹å–„åˆ¤æ–­';
    iteration: '2é€±é–“ã‚µã‚¤ã‚¯ãƒ«ã§ã®ç¶™ç¶šæ”¹å–„';
  };
}
```

## 6. æˆåŠŸåŸºæº–ãƒ»å®Œäº†å®šç¾©

### 6.1 MVPï¼ˆMinimum Viable Productï¼‰åŸºæº–

```typescript
interface MVPCriteria {
  core: {
    automated: '15åˆ†é–“éš”ã§ã®è‡ªå‹•å®Ÿè¡Œ';
    scraping: 'ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹ã‹ã‚‰ã®æ¡ˆä»¶å–å¾—';
    evaluation: 'ChatGPT ã«ã‚ˆã‚‹åŸºæœ¬è©•ä¾¡';
    notification: 'é«˜è©•ä¾¡æ¡ˆä»¶ã®é€šçŸ¥';
    storage: 'S3 ã§ã®7æ—¥é–“ãƒ‡ãƒ¼ã‚¿ä¿æŒ';
  };
  
  quality: {
    reliability: '80%ä»¥ä¸Šã®æˆåŠŸç‡';
    cost: 'æœˆ$5ä»¥ä¸‹ã®é‹ç”¨ã‚³ã‚¹ãƒˆ';
    performance: 'å¹³å‡å®Ÿè¡Œæ™‚é–“2åˆ†ä»¥å†…';
  };
  
  deliverables: [
    'å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAWSæœ¬ç•ªç’°å¢ƒï¼‰',
    'ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆGitHubãƒªãƒã‚¸ãƒˆãƒªï¼‰',
    'è¨­è¨ˆæ›¸ãƒ»é‹ç”¨æ‰‹é †æ›¸',
    'åŸºæœ¬çš„ãªç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š'
  ];
}
```

ã“ã®å®Ÿè£…è¨ˆç”»æ›¸ã«ã‚ˆã‚Šã€S3ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨ã‚³ã‚¹ãƒˆåˆ¶ç´„$5/æœˆã‚’æº€ãŸã—ãªãŒã‚‰ã€æ®µéšçš„ã‹ã¤ç¢ºå®Ÿã«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹å…·ä½“çš„ãªé“ç­‹ãŒç¤ºã•ã‚Œã¾ã—ãŸã€‚
</file>

<file path="readme.md">
# CrowdWorks Search System

ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚¹æ¡ˆä»¶è‡ªå‹•æ¤œç´¢ãƒ»è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ   
AWS Lambda + TypeScript + Docker ã«ã‚ˆã‚‹ ã‚µãƒ¼ãƒãƒ¬ã‚¹æ§‹æˆ

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- **è¨€èª**: TypeScript (strict mode, anyå‹ç¦æ­¢)
- **å®Ÿè¡Œç’°å¢ƒ**: AWS Lambda (Node.js 18)
- **é–‹ç™ºç’°å¢ƒ**: Docker (Lambda Runtime Interface Emulator)
- **ã‚¤ãƒ³ãƒ•ãƒ©**: AWS CDK (Infrastructure as Code)
- **CI/CD**: GitHub Actions
- **ãƒ†ã‚¹ãƒˆ**: Jest + ts-jest

## ğŸ› ï¸ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Docker & Docker Compose
- Git
- VS Code (æ¨å¥¨)

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone <repository-url>
cd crowdworks-search
```

### 2. Dockerç’°å¢ƒã§ã®é–‹ç™ºé–‹å§‹

```bash
# é–‹ç™ºç’°å¢ƒã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
docker-compose up -d

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚·ã‚§ãƒ«ã‚’é–‹ã
docker-compose exec crowdworks-search bash

# ã¾ãŸã¯ã€ç›´æ¥ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
docker-compose exec crowdworks-search npm run build
```

### 3. é–‹ç™ºç”¨ã‚³ãƒãƒ³ãƒ‰

```bash
# TypeScript ãƒ“ãƒ«ãƒ‰
npm run build

# å‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# Lint ãƒã‚§ãƒƒã‚¯
npm run lint

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run format

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
npm run test:coverage

# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼‰
npm run dev
```

## ğŸ³ Dockerç’°å¢ƒã®è©³ç´°

### ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ

```yaml
# ãƒ¡ã‚¤ãƒ³é–‹ç™ºç’°å¢ƒ
docker-compose up                    # é–‹ç™ºç”¨ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•

# ãƒ†ã‚¹ãƒˆå°‚ç”¨ç’°å¢ƒ
docker-compose --profile test up     # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

# CDKå°‚ç”¨ç’°å¢ƒ
docker-compose --profile cdk up      # AWS CDKæ“ä½œ

# Lambdaç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
docker-compose --profile lambda up   # æœ¬ç•ªç’°å¢ƒãƒ†ã‚¹ãƒˆ
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒã‚¦ãƒ³ãƒˆ

```
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ  â†’ /workspace (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ)
~/.aws             â†’ /root/.aws (AWSèªè¨¼æƒ…å ±)
```

### ç’°å¢ƒå¤‰æ•°

```bash
# é–‹ç™ºç’°å¢ƒ
NODE_ENV=development
AWS_REGION=ap-northeast-1
LOG_LEVEL=debug

# ãƒ†ã‚¹ãƒˆç’°å¢ƒ
NODE_ENV=test
AWS_REGION=ap-northeast-1
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆã®ç¨®é¡

```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆ
npm test

# çµåˆãƒ†ã‚¹ãƒˆ  
npm run test:integration

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm run test:coverage
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆDockerç’°å¢ƒï¼‰

```bash
# Dockerå†…ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose --profile test run --rm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
docker-compose --profile test run --rm test npm run test:coverage
```

## ğŸ—ï¸ AWS CDKæ“ä½œ

### CDK ã‚³ãƒãƒ³ãƒ‰

```bash
# CDKå°‚ç”¨ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker-compose --profile cdk up -d

# CDKæ“ä½œ
docker-compose exec cdk cdk synth    # CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
docker-compose exec cdk cdk diff     # å·®åˆ†ç¢ºèª
docker-compose exec cdk cdk deploy   # ãƒ‡ãƒ—ãƒ­ã‚¤
docker-compose exec cdk cdk destroy  # å‰Šé™¤
```

### ç’°å¢ƒåˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Stagingç’°å¢ƒ
docker-compose exec cdk cdk deploy --context stage=staging

# Productionç’°å¢ƒ
docker-compose exec cdk cdk deploy --context stage=production
```

## ğŸ“ ã‚³ãƒ¼ãƒ‰è¦ç´„

### TypeScript è¨­å®š

- **strict mode**: æœ‰åŠ¹
- **anyå‹**: ä½¿ç”¨ç¦æ­¢ (ESLintã‚¨ãƒ©ãƒ¼)
- **å‹å®šç¾©**: å…¨é–¢æ•°ãƒ»å¤‰æ•°ã«å¿…é ˆ
- **æœªä½¿ç”¨å¤‰æ•°**: ã‚¨ãƒ©ãƒ¼

### ESLint ãƒ«ãƒ¼ãƒ«

```typescript
// âŒ ç¦æ­¢
const data: any = response;
function process(input) { }

// âœ… æ¨å¥¨
const data: ResponseData = response;
function process(input: InputData): OutputData { }
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ types/           # å‹å®šç¾©
â”œâ”€â”€ services/        # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ utils/           # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ infrastructure/  # AWS CDK
â””â”€â”€ lambda/          # Lambdaé–¢æ•°
```

## ğŸš€ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### GitHub Actions

```mermaid
graph LR
    A[Code Push] --> B[Code Quality]
    B --> C[Unit Tests]
    B --> D[Build Test]
    B --> E[CDK Synth]
    C --> F[Integration Tests]
    D --> F
    E --> F
    F --> G[Deploy Staging]
    G --> H[Deploy Production]
```

### å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°

- **Push to main**: Full pipeline + Staging deploy
- **Pull Request**: Code quality + tests
- **Release tag**: Production deploy (manual approval)

## ğŸ” ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

### GitHub Secrets

```bash
# AWSèªè¨¼æƒ…å ±
STAGING_AWS_ACCESS_KEY_ID
STAGING_AWS_SECRET_ACCESS_KEY
PRODUCTION_AWS_ACCESS_KEY_ID
PRODUCTION_AWS_SECRET_ACCESS_KEY

# å¤–éƒ¨API
OPENAI_API_KEY
CROWDWORKS_EMAIL
CROWDWORKS_PASSWORD
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

```bash
# AWSèªè¨¼æƒ…å ±è¨­å®š
docker-compose exec crowdworks-search aws configure

# ã¾ãŸã¯ ~/.aws ã‚’ãƒã‚¦ãƒ³ãƒˆï¼ˆdocker-compose.ymlè¨­å®šæ¸ˆã¿ï¼‰
```

## ğŸš€ Lambda ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆ

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®Lambdaç’°å¢ƒãƒ†ã‚¹ãƒˆ

```bash
# Lambdaç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
docker-compose --profile lambda up

# Lambdaé–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
curl -XPOST "http://localhost:9000/2015-03-31/functions/function/invocations" \
  -d '{"source":"aws.events","detail-type":"Scheduled Event","detail":{}}'
```

### ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

```bash
# 1. ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build

# 2. CDK æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
npm run cdk:synth

# 3. Staging ãƒ‡ãƒ—ãƒ­ã‚¤
npm run cdk:deploy -- --context stage=staging

# 4. Production ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ï¼‰
git tag v1.0.0
git push origin v1.0.0
```

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°

### ãƒ­ã‚°ç¢ºèª

```bash
# é–‹ç™ºç’°å¢ƒãƒ­ã‚°
docker-compose logs -f crowdworks-search

# AWS Lambda ãƒ­ã‚°
aws logs tail /aws/lambda/crowdworks-searcher-main --follow
```

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹

- **å®Ÿè¡Œæ™‚é–“**: 1åˆ†ä»¥å†…ç›®æ¨™
- **æˆåŠŸç‡**: 95%ä»¥ä¸Š
- **æœˆé–“ã‚³ã‚¹ãƒˆ**: $5ä»¥ä¸‹

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### TypeScript ã‚¨ãƒ©ãƒ¼

```bash
# å‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# ãƒ“ãƒ«ãƒ‰ã‚¯ãƒªã‚¢
npm run clean && npm run build
```

#### Docker ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸å†ãƒ“ãƒ«ãƒ‰
docker-compose build --no-cache

# ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤
docker-compose down -v
```

#### Jest ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
docker-compose exec crowdworks-search npm test -- --clearCache

# ç‰¹å®šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec crowdworks-search npm test -- test/sample.test.ts
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [AWS Lambda Node.js](https://docs.aws.amazon.com/lambda/latest/dg/lambda-nodejs.html)
- [AWS CDK TypeScript](https://docs.aws.amazon.com/cdk/v2/guide/work-with-cdk-typescript.html)
- [TypeScript Strict Mode](https://www.typescriptlang.org/docs/handbook/2/basic-types.html#strictness)
- [Jest Testing Framework](https://jestjs.io/docs/getting-started)

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Feature ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
2. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
3. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
4. Pull Request ã‚’ä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
</file>

</files>
